#!/usr/bin/env python
# -*- coding: utf-8 -*-
#
# Author:  Dominik Gresch <greschd@gmx.ch>
# Date:    15.10.2014 10:22:43 CEST
# File:    tb_example.py

from common import *

import os
import types
import shutil

class TbModelTestCase(BuildDirTestCase):

    def create_model(self, t1, t2):
        on_site = [1, 1, -1, -1]
        hoppings = [[0, 2, [0, 0, 0], t1],
                    [0, 2, [-1, 0, 0], t1 * (-1j)],
                    [0, 2, [-1, -1, 0], t1 * (-1)],
                    [0, 2, [0, -1, 0], t1 * (1j)],
                    [1, 3, [0, 0, 0], t1],
                    [1, 3, [-1, 0, 0], t1 * (1j)],
                    [1, 3, [-1, -1, 0], t1 * (-1)],
                    [1, 3, [0, -1, 0], t1 * (-1j)],
                    [0, 0, [1, 0, 0], t2],
                    [0, 0, [0, 1, 0], t2],
                    [1, 1, [1, 0, 0], t2],
                    [1, 1, [0, 1, 0], t2],
                    [2, 2, [1, 0, 0], -t2],
                    [2, 2, [0, 1, 0], -t2],
                    [3, 3, [1, 0, 0], -t2],
                    [3, 3, [0, 1, 0], -t2]]
                    
        positions = [[0., 0., 0.], [0., 0., 0.], [0.5, 0.5, 0.], [0.5, 0.5, 0.]]
        self.model = z2pack.em.tb.Model(on_site, hoppings, positions, occ=2)

    # this test may produce false negatives due to small numerical differences
    def test_res1(self):
        self.create_model(0.2, 0.3)
        # call to Z2Pack
        tb_system = z2pack.em.tb.System(self.model)
        tb_surface = tb_system.surface(lambda kx, ky: [kx / 2, ky, 0], pickle_file=None)
        tb_surface.wcc_calc(verbose=False, num_strings=20)

        res = {'t_par': [0.0, 0.052631578947368418, 0.10526315789473684, 0.15789473684210525, 0.21052631578947367, 0.26315789473684209, 0.31578947368421051, 0.36842105263157893, 0.42105263157894735, 0.47368421052631576, 0.52631578947368418, 0.57894736842105265, 0.63157894736842102, 0.68421052631578938, 0.73684210526315785, 0.78947368421052633, 0.84210526315789469, 0.89473684210526305, 0.94736842105263153, 1.0], 'wcc': [[0.49993971392030723, 0.50006028607969299], [0.49839809346166619, 0.50160190653833392], [0.49777184404653835, 0.5022281559534616], [0.49451593469679561, 0.50548406530320444], [0.49458102112100638, 0.50541897887899356], [0.4903638545336429, 0.50963614546635716], [0.48751533406257919, 0.51248466593742092], [0.4869769345497662, 0.51302306545023391], [0.48226564181901088, 0.51773435818098934], [0.47570697515289351, 0.52429302484710671], [0.47100070960259216, 0.5289992903974079], [0.45989755060452209, 0.54010244939547791], [0.44107069988514236, 0.55892930011485786], [0.42258199845339073, 0.57741800154660949], [0.38071876959971995, 0.61928123040028005], [0.32425083021904749, 0.67574916978095256], [0.24653322016249726, 0.75346677983750276], [0.15959501256116454, 0.84040498743883574], [0.079404664480122011, 0.92059533551987816], [0.0014565534680154818, 0.99854344653198457]], 'lambda_': [array([[ -9.99999928e-01+0.00033091j,  -5.79552927e-05+0.00017499j],
       [  5.79552927e-05+0.00017499j,  -9.99999928e-01-0.00033091j]]), array([[ -9.99949348e-01-0.01006034j,   2.54407348e-04-0.0001646j ],
       [ -2.54407348e-04-0.0001646j ,  -9.99949348e-01+0.01006034j]]), array([[ -9.99902003e-01-0.01369004j,  -4.96644043e-04+0.00288459j],
       [  4.96644043e-04+0.00288459j,  -9.99902003e-01+0.01369004j]]), array([[-0.99940640-0.03442998j, -0.00102744+0.00060299j],
       [ 0.00102744+0.00060299j, -0.99940640+0.03442998j]]), array([[-0.99942041-0.03386779j, -0.00132044+0.0031746j ],
       [ 0.00132044+0.0031746j , -0.99942041+0.03386779j]]), array([[-0.99816767-0.0604401j , -0.00256882+0.00130328j],
       [ 0.00256882+0.00130328j, -0.99816767+0.0604401j ]]), array([[-0.99692489-0.07807345j, -0.00652206-0.00166316j],
       [ 0.00652206-0.00166316j, -0.99692489+0.07807345j]]), array([[-0.99665409-0.08164318j,  0.00315198-0.00225258j],
       [-0.00315198-0.00225258j, -0.99665409+0.08164318j]]), array([[-0.99379829-0.11115468j, -0.00309124-0.00019051j],
       [ 0.00309124-0.00019051j, -0.99379829+0.11115468j]]), array([[-0.98837348-0.15202139j,  0.00227225-0.00147912j],
       [-0.00227225-0.00147912j, -0.98837348+0.15202139j]]), array([[-0.98344601-0.17945577j, -0.02176859+0.01247771j],
       [ 0.02176859+0.01247771j, -0.98344601+0.17945577j]]), array([[-0.96842288-0.247966j  , -0.02543184+0.00481831j],
       [ 0.02543184+0.00481831j, -0.96842288+0.247966j  ]]), array([[-0.93223195-0.3596837j ,  0.03905663+0.00676821j],
       [-0.03905663+0.00676821j, -0.93223195+0.3596837j ]]), array([[-0.88400660-0.46505698j, -0.04182879-0.02246536j],
       [ 0.04182879-0.02246536j, -0.88400660+0.46505698j]]), array([[-0.73205271-0.67083314j,  0.11819815+0.01053196j],
       [-0.11819815+0.01053196j, -0.73205271+0.67083314j]]), array([[-0.44979136-0.89280784j,  0.02123964+0.01143542j],
       [-0.02123964+0.01143542j, -0.44979136+0.89280784j]]), array([[ 0.02178070-0.99049701j,  0.03607261+0.13092002j],
       [-0.03607261+0.13092002j,  0.02178070+0.99049701j]]), array([[ 0.53797354 -8.42955824e-01j, -0.00310705 -5.38769310e-04j],
       [ 0.00310705 -5.38769310e-04j,  0.53797354 +8.42955824e-01j]]), array([[ 0.87810259-0.47818837j, -0.00540566+0.01557238j],
       [ 0.00540566+0.01557238j,  0.87810259+0.47818837j]]), array([[ 0.99995812-0.00761364j, -0.00485131-0.00150008j],
       [ 0.00485131-0.00150008j,  0.99995812+0.00761364j]])], 'kpt': [[0.0, 0.0, 0], [0.026315789473684209, 0.0, 0], [0.052631578947368418, 0.0, 0], [0.078947368421052627, 0.0, 0], [0.10526315789473684, 0.0, 0], [0.13157894736842105, 0.0, 0], [0.15789473684210525, 0.0, 0], [0.18421052631578946, 0.0, 0], [0.21052631578947367, 0.0, 0], [0.23684210526315788, 0.0, 0], [0.26315789473684209, 0.0, 0], [0.28947368421052633, 0.0, 0], [0.31578947368421051, 0.0, 0], [0.34210526315789469, 0.0, 0], [0.36842105263157893, 0.0, 0], [0.39473684210526316, 0.0, 0], [0.42105263157894735, 0.0, 0], [0.44736842105263153, 0.0, 0], [0.47368421052631576, 0.0, 0], [0.5, 0.0, 0]], 'gap': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.5, 0.50000000000000022, 0.5, 0.5]}

        self.assertFullAlmostEqual(tb_surface.get_res(), res)

    def test_res2(self):
        """ test pos_check=False """
        self.create_model(0, 0.3)
        # call to Z2Pack
        tb_system = z2pack.em.tb.System(self.model)
        tb_surface = tb_system.surface(lambda kx, ky: [kx / 2, ky, 0], pickle_file=None)
        tb_surface.wcc_calc(verbose=False,
                            num_strings=20,
                            pos_tol=None)

        res = {'t_par': [0.0, 0.052631578947368418, 0.10526315789473684, 0.15789473684210525, 0.21052631578947367, 0.26315789473684209, 0.31578947368421051, 0.36842105263157893, 0.42105263157894735, 0.47368421052631576, 0.52631578947368418, 0.57894736842105265, 0.63157894736842102, 0.68421052631578938, 0.73684210526315785, 0.78947368421052633, 0.84210526315789469, 0.89473684210526305, 0.94736842105263153, 1.0], 'wcc': [[0.5, 0.5], [0.5, 0.5], [0.5, 0.5], [0.5, 0.5], [0.5, 0.5], [0.5, 0.5], [0.5, 0.5], [0.5, 0.5], [0.5, 0.5], [0.5, 0.5], [0.5, 0.5], [0.5, 0.5], [0.5, 0.5], [0.5, 0.5], [0.625, 0.625], [0.625, 0.625], [0.625, 0.625], [0.625, 0.625], [0.75, 0.75], [0.75, 0.75]], 'lambda_': [array([[-1. -1.66533454e-16j,  0. +0.00000000e+00j],
       [ 0. +0.00000000e+00j, -1. -1.66533454e-16j]]), array([[-1. -1.66533454e-16j,  0. +0.00000000e+00j],
       [ 0. +0.00000000e+00j, -1. -1.66533454e-16j]]), array([[-1. -1.66533454e-16j,  0. +0.00000000e+00j],
       [ 0. +0.00000000e+00j, -1. -1.66533454e-16j]]), array([[-1. -1.66533454e-16j,  0. +0.00000000e+00j],
       [ 0. +0.00000000e+00j, -1. -1.66533454e-16j]]), array([[-1. -1.66533454e-16j,  0. +0.00000000e+00j],
       [ 0. +0.00000000e+00j, -1. -1.66533454e-16j]]), array([[-1. -1.66533454e-16j,  0. +0.00000000e+00j],
       [ 0. +0.00000000e+00j, -1. -1.66533454e-16j]]), array([[-1. -1.66533454e-16j,  0. +0.00000000e+00j],
       [ 0. +0.00000000e+00j, -1. -1.66533454e-16j]]), array([[-1. -1.66533454e-16j,  0. +0.00000000e+00j],
       [ 0. +0.00000000e+00j, -1. -1.66533454e-16j]]), array([[-1. -1.66533454e-16j,  0. +0.00000000e+00j],
       [ 0. +0.00000000e+00j, -1. -1.66533454e-16j]]), array([[-1. -1.66533454e-16j,  0. +0.00000000e+00j],
       [ 0. +0.00000000e+00j, -1. -1.66533454e-16j]]), array([[-1. -1.66533454e-16j,  0. +0.00000000e+00j],
       [ 0. +0.00000000e+00j, -1. -1.66533454e-16j]]), array([[-1. -1.66533454e-16j,  0. +0.00000000e+00j],
       [ 0. +0.00000000e+00j, -1. -1.66533454e-16j]]), array([[-1. -1.66533454e-16j,  0. +0.00000000e+00j],
       [ 0. +0.00000000e+00j, -1. -1.66533454e-16j]]), array([[-1. -1.66533454e-16j,  0. +0.00000000e+00j],
       [ 0. +0.00000000e+00j, -1. -1.66533454e-16j]]), array([[-0.70710678+0.70710678j,  0.00000000+0.j        ],
       [ 0.00000000+0.j        , -0.70710678+0.70710678j]]), array([[-0.70710678+0.70710678j,  0.00000000+0.j        ],
       [ 0.00000000+0.j        , -0.70710678+0.70710678j]]), array([[-0.70710678+0.70710678j,  0.00000000+0.j        ],
       [ 0.00000000+0.j        , -0.70710678+0.70710678j]]), array([[-0.70710678+0.70710678j,  0.00000000+0.j        ],
       [ 0.00000000+0.j        , -0.70710678+0.70710678j]]), array([[ -1.11022302e-16+1.j,   0.00000000e+00+0.j],
       [  0.00000000e+00+0.j,  -1.11022302e-16+1.j]]), array([[ -1.11022302e-16+1.j,   0.00000000e+00+0.j],
       [  0.00000000e+00+0.j,  -1.11022302e-16+1.j]])], 'kpt': [[0.0, 0.0, 0], [0.026315789473684209, 0.0, 0], [0.052631578947368418, 0.0, 0], [0.078947368421052627, 0.0, 0], [0.10526315789473684, 0.0, 0], [0.13157894736842105, 0.0, 0], [0.15789473684210525, 0.0, 0], [0.18421052631578946, 0.0, 0], [0.21052631578947367, 0.0, 0], [0.23684210526315788, 0.0, 0], [0.26315789473684209, 0.0, 0], [0.28947368421052633, 0.0, 0], [0.31578947368421051, 0.0, 0], [0.34210526315789469, 0.0, 0], [0.36842105263157893, 0.0, 0], [0.39473684210526316, 0.0, 0], [0.42105263157894735, 0.0, 0], [0.44736842105263153, 0.0, 0], [0.47368421052631576, 0.0, 0], [0.5, 0.0, 0]], 'gap': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.125, 0.125, 0.125, 0.125, 0.25, 0.25]}

        self.assertFullAlmostEqual(tb_surface.get_res(), res)

    def test_res3(self):
        """ test gap_tol=None """
        self.create_model(0.1, 0.3)
        # call to Z2Pack
        tb_system = z2pack.em.tb.System(self.model)
        tb_surface = tb_system.surface(lambda kx, ky: [kx / 2, ky, 0], pickle_file=None)
        tb_surface.wcc_calc(verbose=False,
                            num_strings=20,
                            gap_tol=None)

        res = {'t_par': [0.0, 0.052631578947368418, 0.10526315789473684, 0.15789473684210525, 0.21052631578947367, 0.26315789473684209, 0.31578947368421051, 0.36842105263157893, 0.42105263157894735, 0.47368421052631576, 0.52631578947368418, 0.57894736842105265, 0.63157894736842102, 0.68421052631578938, 0.73684210526315785, 0.78947368421052633, 0.84210526315789469, 0.89473684210526305, 0.94736842105263153, 1.0], 'wcc': [[0.4999877229169376, 0.5000122770830624], [0.49956475705501235, 0.50043524294498787], [0.4992387807325534, 0.50076121926744699], [0.49902825613107987, 0.50097174386892029], [0.49855386122808587, 0.50144613877191424], [0.49740259262205089, 0.50259740737794911], [0.49651104294287918, 0.50348895705712104], [0.49589349414615086, 0.5041065058538492], [0.49466965504030885, 0.50533034495969109], [0.49256858760975136, 0.50743141239024858], [0.49074703814921833, 0.50925296185078184], [0.48552226537253468, 0.51447773462746538], [0.47717727892234607, 0.52282272107765393], [0.4635031518271237, 0.53649684817287624], [0.41699779540947846, 0.58300220459052154], [0.32972611989658412, 0.67027388010341582], [0.22704073347978973, 0.77295926652021019], [0.14243318684650566, 0.85756681315349426], [0.067698120632063305, 0.93230187936793685], [0.0013721964517045913, 0.99862780354829561]], 'lambda_': [array([[ -9.99999997e-01 +7.11082504e-05j,
         -1.37682150e-05 +2.65425560e-05j],
       [  1.37682150e-05 +2.65425560e-05j,
         -9.99999997e-01 -7.11082504e-05j]]), array([[ -9.99996261e-01 -2.73433982e-03j,
          4.36274411e-05 -1.06730211e-05j],
       [ -4.36274411e-05 -1.06730211e-05j,
         -9.99996261e-01 +2.73433982e-03j]]), array([[ -9.99988562e-01-0.00477624j,  -7.48831845e-05+0.00024014j],
       [  7.48831845e-05+0.00024014j,  -9.99988562e-01+0.00477624j]]), array([[ -9.99981361e-01-0.00610168j,  -1.27593620e-04-0.00017792j],
       [  1.27593620e-04-0.00017792j,  -9.99981361e-01+0.00610168j]]), array([[ -9.99958719e-01-0.00907334j,  -2.23135474e-04+0.0004293j ],
       [  2.23135474e-04+0.0004293j ,  -9.99958719e-01+0.00907334j]]), array([[ -9.99866832e-01 -1.63131035e-02j,
         -4.46597646e-04 +4.11736696e-05j],
       [  4.46597646e-04 +4.11736696e-05j,
         -9.99866832e-01 +1.63131035e-02j]]), array([[ -9.99759728e-01-0.02190142j,  -8.67248757e-04-0.00024964j],
       [  8.67248757e-04-0.00024964j,  -9.99759728e-01+0.02190142j]]), array([[ -9.99667148e-01-0.02578765j,   7.19067833e-04-0.00026875j],
       [ -7.19067833e-04-0.00026875j,  -9.99667148e-01+0.02578765j]]), array([[ -9.99439211e-01 -3.34808440e-02j,
         -5.43139246e-04 -4.84772598e-05j],
       [  5.43139246e-04 -4.84772598e-05j,
         -9.99439211e-01 +3.34808440e-02j]]), array([[ -9.98910083e-01-0.0466721j ,   4.53354194e-04-0.00039512j],
       [ -4.53354194e-04-0.00039512j,  -9.98910083e-01+0.0466721j ]]), array([[-0.99831046-0.05796809j, -0.00355797+0.00180852j],
       [ 0.00355797+0.00180852j, -0.99831046+0.05796809j]]), array([[-0.99586542-0.09068864j, -0.00518335+0.00087717j],
       [ 0.00518335+0.00087717j, -0.99586542+0.09068864j]]), array([[-0.98973591-0.14262975j,  0.00876179+0.00167428j],
       [-0.00876179+0.00167428j, -0.98973591+0.14262975j]]), array([[-0.97382200-0.22684101j, -0.01437382-0.00269481j],
       [ 0.01437382-0.00269481j, -0.97382200+0.22684101j]]), array([[-0.8670638-0.49626463j,  0.0435676+0.00486277j],
       [-0.0435676+0.00486277j, -0.8670638+0.49626463j]]), array([[-0.48024498 -8.77119578e-01j,  0.00509828 +1.17068612e-04j],
       [-0.00509828 +1.17068612e-04j, -0.48024498 +8.77119578e-01j]]), array([[ 0.14375751-0.98565666j,  0.01042592+0.08778401j],
       [-0.01042592+0.08778401j,  0.14375751+0.98565666j]]), array([[ 0.62557023 -7.80166025e-01j,  0.00165766 +3.44896109e-04j],
       [-0.00165766 +3.44896109e-04j,  0.62557023 +7.80166025e-01j]]), array([[ 0.91089031-0.41263672j, -0.00100123+0.00296375j],
       [ 0.00100123+0.00296375j,  0.91089031+0.41263672j]]), array([[ 0.99996283-0.00300278j, -0.00162107+0.0079176j ],
       [ 0.00162107+0.0079176j ,  0.99996283+0.00300278j]])], 'kpt': [[0.0, 0.0, 0], [0.026315789473684209, 0.0, 0], [0.052631578947368418, 0.0, 0], [0.078947368421052627, 0.0, 0], [0.10526315789473684, 0.0, 0], [0.13157894736842105, 0.0, 0], [0.15789473684210525, 0.0, 0], [0.18421052631578946, 0.0, 0], [0.21052631578947367, 0.0, 0], [0.23684210526315788, 0.0, 0], [0.26315789473684209, 0.0, 0], [0.28947368421052633, 0.0, 0], [0.31578947368421051, 0.0, 0], [0.34210526315789469, 0.0, 0], [0.36842105263157893, 0.0, 0], [0.39473684210526316, 0.0, 0], [0.42105263157894735, 0.0, 0], [0.44736842105263153, 0.0, 0], [0.47368421052631576, 0.0, 0], [0.5, 0.0, 0]], 'gap': [0.0, 0.0, 2.2204460492503131e-16, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.5, 0.5, 0.50000000000000011, 0.50000000000000011]}

        self.assertFullAlmostEqual(tb_surface.get_res(), res)

    def test_res4(self):
        """ test move_tol=None """
        self.create_model(0.1, 0.3)
        # call to Z2Pack
        tb_system = z2pack.em.tb.System(self.model)
        tb_surface = tb_system.surface(lambda kx, ky: [kx / 2, ky, 0], pickle_file=None)
        tb_surface.wcc_calc(verbose=False,
                          num_strings=20,
                          move_tol=None)

        res = {'t_par': [0.0, 0.052631578947368418, 0.10526315789473684, 0.15789473684210525, 0.21052631578947367, 0.26315789473684209, 0.31578947368421051, 0.36842105263157893, 0.42105263157894735, 0.47368421052631576, 0.52631578947368418, 0.57894736842105265, 0.63157894736842102, 0.68421052631578938, 0.73684210526315785, 0.78947368421052633, 0.84210526315789469, 0.89473684210526305, 0.94736842105263153, 1.0], 'wcc': [[0.4999877229169376, 0.5000122770830624], [0.49956475705501235, 0.50043524294498787], [0.4992387807325534, 0.50076121926744699], [0.49902825613107987, 0.50097174386892029], [0.49855386122808587, 0.50144613877191424], [0.49740259262205089, 0.50259740737794911], [0.49651104294287918, 0.50348895705712104], [0.49589349414615086, 0.5041065058538492], [0.49466965504030885, 0.50533034495969109], [0.49256858760975136, 0.50743141239024858], [0.49074703814921833, 0.50925296185078184], [0.48552226537253468, 0.51447773462746538], [0.47717727892234607, 0.52282272107765393], [0.4635031518271237, 0.53649684817287624], [0.41699779540947846, 0.58300220459052154], [0.32972611989658412, 0.67027388010341582], [0.22704073347978973, 0.77295926652021019], [0.14243318684650566, 0.85756681315349426], [0.067698120632063305, 0.93230187936793685], [0.0013721964517045913, 0.99862780354829561]], 'lambda_': [array([[ -9.99999997e-01 +7.11082504e-05j,
         -1.37682150e-05 +2.65425560e-05j],
       [  1.37682150e-05 +2.65425560e-05j,
         -9.99999997e-01 -7.11082504e-05j]]), array([[ -9.99996261e-01 -2.73433982e-03j,
          4.36274411e-05 -1.06730211e-05j],
       [ -4.36274411e-05 -1.06730211e-05j,
         -9.99996261e-01 +2.73433982e-03j]]), array([[ -9.99988562e-01-0.00477624j,  -7.48831845e-05+0.00024014j],
       [  7.48831845e-05+0.00024014j,  -9.99988562e-01+0.00477624j]]), array([[ -9.99981361e-01-0.00610168j,  -1.27593620e-04-0.00017792j],
       [  1.27593620e-04-0.00017792j,  -9.99981361e-01+0.00610168j]]), array([[ -9.99958719e-01-0.00907334j,  -2.23135474e-04+0.0004293j ],
       [  2.23135474e-04+0.0004293j ,  -9.99958719e-01+0.00907334j]]), array([[ -9.99866832e-01 -1.63131035e-02j,
         -4.46597646e-04 +4.11736696e-05j],
       [  4.46597646e-04 +4.11736696e-05j,
         -9.99866832e-01 +1.63131035e-02j]]), array([[ -9.99759728e-01-0.02190142j,  -8.67248757e-04-0.00024964j],
       [  8.67248757e-04-0.00024964j,  -9.99759728e-01+0.02190142j]]), array([[ -9.99667148e-01-0.02578765j,   7.19067833e-04-0.00026875j],
       [ -7.19067833e-04-0.00026875j,  -9.99667148e-01+0.02578765j]]), array([[ -9.99439211e-01 -3.34808440e-02j,
         -5.43139246e-04 -4.84772598e-05j],
       [  5.43139246e-04 -4.84772598e-05j,
         -9.99439211e-01 +3.34808440e-02j]]), array([[ -9.98910083e-01-0.0466721j ,   4.53354194e-04-0.00039512j],
       [ -4.53354194e-04-0.00039512j,  -9.98910083e-01+0.0466721j ]]), array([[-0.99831046-0.05796809j, -0.00355797+0.00180852j],
       [ 0.00355797+0.00180852j, -0.99831046+0.05796809j]]), array([[-0.99586542-0.09068864j, -0.00518335+0.00087717j],
       [ 0.00518335+0.00087717j, -0.99586542+0.09068864j]]), array([[-0.98973591-0.14262975j,  0.00876179+0.00167428j],
       [-0.00876179+0.00167428j, -0.98973591+0.14262975j]]), array([[-0.97382200-0.22684101j, -0.01437382-0.00269481j],
       [ 0.01437382-0.00269481j, -0.97382200+0.22684101j]]), array([[-0.8670638-0.49626463j,  0.0435676+0.00486277j],
       [-0.0435676+0.00486277j, -0.8670638+0.49626463j]]), array([[-0.48024498 -8.77119578e-01j,  0.00509828 +1.17068612e-04j],
       [-0.00509828 +1.17068612e-04j, -0.48024498 +8.77119578e-01j]]), array([[ 0.14375751-0.98565666j,  0.01042592+0.08778401j],
       [-0.01042592+0.08778401j,  0.14375751+0.98565666j]]), array([[ 0.62557023 -7.80166025e-01j,  0.00165766 +3.44896109e-04j],
       [-0.00165766 +3.44896109e-04j,  0.62557023 +7.80166025e-01j]]), array([[ 0.91089031-0.41263672j, -0.00100123+0.00296375j],
       [ 0.00100123+0.00296375j,  0.91089031+0.41263672j]]), array([[ 0.99996283-0.00300278j, -0.00162107+0.0079176j ],
       [ 0.00162107+0.0079176j ,  0.99996283+0.00300278j]])], 'kpt': [[0.0, 0.0, 0], [0.026315789473684209, 0.0, 0], [0.052631578947368418, 0.0, 0], [0.078947368421052627, 0.0, 0], [0.10526315789473684, 0.0, 0], [0.13157894736842105, 0.0, 0], [0.15789473684210525, 0.0, 0], [0.18421052631578946, 0.0, 0], [0.21052631578947367, 0.0, 0], [0.23684210526315788, 0.0, 0], [0.26315789473684209, 0.0, 0], [0.28947368421052633, 0.0, 0], [0.31578947368421051, 0.0, 0], [0.34210526315789469, 0.0, 0], [0.36842105263157893, 0.0, 0], [0.39473684210526316, 0.0, 0], [0.42105263157894735, 0.0, 0], [0.44736842105263153, 0.0, 0], [0.47368421052631576, 0.0, 0], [0.5, 0.0, 0]], 'gap': [0.0, 0.0, 2.2204460492503131e-16, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.5, 0.5, 0.50000000000000011, 0.50000000000000011]}

        self.assertFullAlmostEqual(tb_surface.get_res(), res)

    def test_res5(self):
        """ test gap_tol=None and move_tol=None"""
        self.create_model(0.1, 0.3)
        # call to Z2Pack
        tb_system = z2pack.em.tb.System(self.model)
        tb_surface = tb_system.surface(lambda kx, ky: [kx / 2, ky, 0], pickle_file=None)
        tb_surface.wcc_calc(verbose=False,
                            num_strings=20,
                            gap_tol=None,
                            move_tol=None)

        
        res = {'t_par': [0.0, 0.052631578947368418, 0.10526315789473684, 0.15789473684210525, 0.21052631578947367, 0.26315789473684209, 0.31578947368421051, 0.36842105263157893, 0.42105263157894735, 0.47368421052631576, 0.52631578947368418, 0.57894736842105265, 0.63157894736842102, 0.68421052631578938, 0.73684210526315785, 0.78947368421052633, 0.84210526315789469, 0.89473684210526305, 0.94736842105263153, 1.0], 'wcc': [[0.4999877229169376, 0.5000122770830624], [0.49956475705501235, 0.50043524294498787], [0.4992387807325534, 0.50076121926744699], [0.49902825613107987, 0.50097174386892029], [0.49855386122808587, 0.50144613877191424], [0.49740259262205089, 0.50259740737794911], [0.49651104294287918, 0.50348895705712104], [0.49589349414615086, 0.5041065058538492], [0.49466965504030885, 0.50533034495969109], [0.49256858760975136, 0.50743141239024858], [0.49074703814921833, 0.50925296185078184], [0.48552226537253468, 0.51447773462746538], [0.47717727892234607, 0.52282272107765393], [0.4635031518271237, 0.53649684817287624], [0.41699779540947846, 0.58300220459052154], [0.32972611989658412, 0.67027388010341582], [0.22704073347978973, 0.77295926652021019], [0.14243318684650566, 0.85756681315349426], [0.067698120632063305, 0.93230187936793685], [0.0013721964517045913, 0.99862780354829561]], 'lambda_': [array([[ -9.99999997e-01 +7.11082504e-05j,
         -1.37682150e-05 +2.65425560e-05j],
       [  1.37682150e-05 +2.65425560e-05j,
         -9.99999997e-01 -7.11082504e-05j]]), array([[ -9.99996261e-01 -2.73433982e-03j,
          4.36274411e-05 -1.06730211e-05j],
       [ -4.36274411e-05 -1.06730211e-05j,
         -9.99996261e-01 +2.73433982e-03j]]), array([[ -9.99988562e-01-0.00477624j,  -7.48831845e-05+0.00024014j],
       [  7.48831845e-05+0.00024014j,  -9.99988562e-01+0.00477624j]]), array([[ -9.99981361e-01-0.00610168j,  -1.27593620e-04-0.00017792j],
       [  1.27593620e-04-0.00017792j,  -9.99981361e-01+0.00610168j]]), array([[ -9.99958719e-01-0.00907334j,  -2.23135474e-04+0.0004293j ],
       [  2.23135474e-04+0.0004293j ,  -9.99958719e-01+0.00907334j]]), array([[ -9.99866832e-01 -1.63131035e-02j,
         -4.46597646e-04 +4.11736696e-05j],
       [  4.46597646e-04 +4.11736696e-05j,
         -9.99866832e-01 +1.63131035e-02j]]), array([[ -9.99759728e-01-0.02190142j,  -8.67248757e-04-0.00024964j],
       [  8.67248757e-04-0.00024964j,  -9.99759728e-01+0.02190142j]]), array([[ -9.99667148e-01-0.02578765j,   7.19067833e-04-0.00026875j],
       [ -7.19067833e-04-0.00026875j,  -9.99667148e-01+0.02578765j]]), array([[ -9.99439211e-01 -3.34808440e-02j,
         -5.43139246e-04 -4.84772598e-05j],
       [  5.43139246e-04 -4.84772598e-05j,
         -9.99439211e-01 +3.34808440e-02j]]), array([[ -9.98910083e-01-0.0466721j ,   4.53354194e-04-0.00039512j],
       [ -4.53354194e-04-0.00039512j,  -9.98910083e-01+0.0466721j ]]), array([[-0.99831046-0.05796809j, -0.00355797+0.00180852j],
       [ 0.00355797+0.00180852j, -0.99831046+0.05796809j]]), array([[-0.99586542-0.09068864j, -0.00518335+0.00087717j],
       [ 0.00518335+0.00087717j, -0.99586542+0.09068864j]]), array([[-0.98973591-0.14262975j,  0.00876179+0.00167428j],
       [-0.00876179+0.00167428j, -0.98973591+0.14262975j]]), array([[-0.97382200-0.22684101j, -0.01437382-0.00269481j],
       [ 0.01437382-0.00269481j, -0.97382200+0.22684101j]]), array([[-0.8670638-0.49626463j,  0.0435676+0.00486277j],
       [-0.0435676+0.00486277j, -0.8670638+0.49626463j]]), array([[-0.48024498 -8.77119578e-01j,  0.00509828 +1.17068612e-04j],
       [-0.00509828 +1.17068612e-04j, -0.48024498 +8.77119578e-01j]]), array([[ 0.14375751-0.98565666j,  0.01042592+0.08778401j],
       [-0.01042592+0.08778401j,  0.14375751+0.98565666j]]), array([[ 0.62557023 -7.80166025e-01j,  0.00165766 +3.44896109e-04j],
       [-0.00165766 +3.44896109e-04j,  0.62557023 +7.80166025e-01j]]), array([[ 0.91089031-0.41263672j, -0.00100123+0.00296375j],
       [ 0.00100123+0.00296375j,  0.91089031+0.41263672j]]), array([[ 0.99996283-0.00300278j, -0.00162107+0.0079176j ],
       [ 0.00162107+0.0079176j ,  0.99996283+0.00300278j]])], 'kpt': [[0.0, 0.0, 0], [0.026315789473684209, 0.0, 0], [0.052631578947368418, 0.0, 0], [0.078947368421052627, 0.0, 0], [0.10526315789473684, 0.0, 0], [0.13157894736842105, 0.0, 0], [0.15789473684210525, 0.0, 0], [0.18421052631578946, 0.0, 0], [0.21052631578947367, 0.0, 0], [0.23684210526315788, 0.0, 0], [0.26315789473684209, 0.0, 0], [0.28947368421052633, 0.0, 0], [0.31578947368421051, 0.0, 0], [0.34210526315789469, 0.0, 0], [0.36842105263157893, 0.0, 0], [0.39473684210526316, 0.0, 0], [0.42105263157894735, 0.0, 0], [0.44736842105263153, 0.0, 0], [0.47368421052631576, 0.0, 0], [0.5, 0.0, 0]], 'gap': [0.0, 0.0, 2.2204460492503131e-16, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.5, 0.5, 0.50000000000000011, 0.50000000000000011]}

        self.assertFullAlmostEqual(tb_surface.get_res(), res)

    def test_change_uc(self):
        """test chaning the unit cell"""
        self.create_model(0.1, 0.3)
        model = self.model.change_uc([[1, 1, 1], [0, 1, 1], [0, 0, 1]])
        # call to Z2Pack
        tb_system = z2pack.em.tb.System(model)
        tb_surface = tb_system.surface(lambda kx, ky: [kx / 2, ky, 0], pickle_file=None)
        tb_surface.wcc_calc(verbose=False,
                            num_strings=20,
                            gap_tol=None,
                            move_tol=None)

        
        res = {'t_par': [0.0, 0.052631578947368418, 0.10526315789473684, 0.15789473684210525, 0.21052631578947367, 0.26315789473684209, 0.31578947368421051, 0.36842105263157893, 0.42105263157894735, 0.47368421052631576, 0.52631578947368418, 0.57894736842105265, 0.63157894736842102, 0.68421052631578938, 0.73684210526315785, 0.78947368421052633, 0.84210526315789469, 0.89473684210526305, 0.94736842105263153, 1.0], 'wcc': [[0.49988883094870729, 0.50011116905129271], [0.49975970789911739, 0.50024029210088283], [0.49920965900088254, 0.50079034099911757], [0.49826532903027715, 0.50173467096972302], [0.49826867499785349, 0.50173132500214646], [0.49759485929778108, 0.50240514070221898], [0.4965435023748106, 0.50345649762518963], [0.4956846273962644, 0.50431537260373582], [0.49472603316130997, 0.5052739668386903], [0.49251086450985482, 0.50748913549014507], [0.49041880976129321, 0.50958119023870707], [0.48598610125573688, 0.51401389874426318], [0.48000855268586079, 0.51999144731413938], [0.46143878988254106, 0.53856121011745883], [0.41742073155910769, 0.58257926844089258], [0.32721008750837649, 0.67278991249162368], [0.23313324212672648, 0.76686675787327352], [0.14582561429641486, 0.85417438570358517], [0.07136118532833885, 0.92863881467166109], [0.0031329508987717773, 0.99686704910122814]], 'lambda_': [array([[ -9.99999756e-01 +6.96395766e-04j,
          2.37700158e-05 -4.86225907e-05j],
       [ -2.37700158e-05 -4.86225907e-05j,
         -9.99999756e-01 -6.96395766e-04j]]), array([[ -9.99998860e-01-0.0014431j ,  -1.91709354e-04+0.00040027j],
       [  1.91709354e-04+0.00040027j,  -9.99998860e-01+0.0014431j ]]), array([[ -9.99987670e-01 -4.96564605e-03j,
          1.08835002e-05 -4.23470605e-05j],
       [ -1.08835002e-05 -4.23470605e-05j,
         -9.99987670e-01 +4.96564605e-03j]]), array([[ -9.99940604e-01-0.01085614j,  -2.66139176e-04+0.00092868j],
       [  2.66139176e-04+0.00092868j,  -9.99940604e-01+0.01085614j]]), array([[ -9.99940833e-01 -1.08780213e-02j,
         -1.32619728e-16 -4.01661642e-16j],
       [  3.79627049e-17 +2.47075977e-16j,
         -9.99940833e-01 +1.08780213e-02j]]), array([[ -9.99885817e-01-0.01511059j,  -1.21493713e-05+0.0001533j ],
       [  1.21493713e-05+0.0001533j ,  -9.99885817e-01+0.01511059j]]), array([[ -9.99764178e-01-0.02170328j,   3.52662797e-04-0.00065767j],
       [ -3.52662797e-04-0.00065767j,  -9.99764178e-01+0.02170328j]]), array([[ -9.99632430e-01-0.02706605j,  -1.04559185e-04+0.00155636j],
       [  1.04559185e-04+0.00155636j,  -9.99632430e-01+0.02706605j]]), array([[ -9.99451010e-01-0.03313101j,  -4.08358517e-05+0.00011808j],
       [  4.08358517e-05+0.00011808j,  -9.99451010e-01+0.03313101j]]), array([[ -9.98893088e-01-0.04687095j,  -9.60024016e-05+0.00396271j],
       [  9.60024016e-05+0.00396271j,  -9.98893088e-01+0.04687095j]]), array([[ -9.98188503e-01-0.05973303j,  -1.21310253e-05+0.0071886j ],
       [  1.21310253e-05+0.0071886j ,  -9.98188503e-01+0.05973303j]]), array([[ -9.96125933e-01-0.08793756j,  -3.12283251e-04-0.00011419j],
       [  3.12283251e-04-0.00011419j,  -9.96125933e-01+0.08793756j]]), array([[-0.99212144-0.12337637j, -0.00277606+0.0215783j ],
       [ 0.00277606+0.0215783j , -0.99212144+0.12337637j]]), array([[ -9.70791754e-01-0.23987034j,  -6.11746714e-05-0.00505829j],
       [  6.11746714e-05-0.00505829j,  -9.70791754e-01+0.23987034j]]), array([[ -8.68384639e-01 -4.95890977e-01j,
         -3.38577412e-04 -3.76797778e-04j],
       [  3.38577412e-04 -3.76797778e-04j,
         -8.68384639e-01 +4.95890977e-01j]]), array([[ -4.66319194e-01-0.88457289j,  -2.58148775e-04-0.00878357j],
       [  2.58148775e-04-0.00878357j,  -4.66319194e-01+0.88457289j]]), array([[ 0.10577870 -9.94389631e-01j,  0.00027477 +2.29519651e-04j],
       [-0.00027477 +2.29519651e-04j,  0.10577870 +9.94389631e-01j]]), array([[ 0.60879991-0.79306679j,  0.01222939+0.01606805j],
       [-0.01222939+0.01606805j,  0.60879991+0.79306679j]]), array([[ 0.90115249-0.43295926j,  0.02122333+0.00447614j],
       [-0.02122333+0.00447614j,  0.90115249+0.43295926j]]), array([[ 0.99980626+0.01520773j,  0.01248746-0.00048351j],
       [-0.01248746-0.00048351j,  0.99980626-0.01520773j]])], 'kpt': [[0.0, 0.0, 0], [0.026315789473684209, 0.0, 0], [0.052631578947368418, 0.0, 0], [0.078947368421052627, 0.0, 0], [0.10526315789473684, 0.0, 0], [0.13157894736842105, 0.0, 0], [0.15789473684210525, 0.0, 0], [0.18421052631578946, 0.0, 0], [0.21052631578947367, 0.0, 0], [0.23684210526315788, 0.0, 0], [0.26315789473684209, 0.0, 0], [0.28947368421052633, 0.0, 0], [0.31578947368421051, 0.0, 0], [0.34210526315789469, 0.0, 0], [0.36842105263157893, 0.0, 0], [0.39473684210526316, 0.0, 0], [0.42105263157894735, 0.0, 0], [0.44736842105263153, 0.0, 0], [0.47368421052631576, 0.0, 0], [0.5, 0.0, 0]], 'gap': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.5, 0.5, 0.49999999999999994, 0.5]}

        self.assertFullAlmostEqual(tb_surface.get_res(), res)
        
    def test_change_uc_inplace(self):
        """test chaning the unit cell"""
        self.create_model(0.1, 0.3)
        model = self.model.change_uc([[1, 1, 1], [0, 1, 1], [0, 0, 1]])
        self.model.change_uc([[1, 1, 1], [0, 1, 1], [0, 0, 1]], in_place=True)
        system0 = z2pack.em.tb.System(model)
        surface0 = system0.surface(lambda kx, ky: [kx / 2, ky, 0], pickle_file=None)
        surface0.wcc_calc(verbose=False,
                          num_strings=20,
                          gap_tol=None,
                          move_tol=None)
        system1 = z2pack.em.tb.System(self.model)
        surface1 = system1.surface(lambda kx, ky: [kx / 2, ky, 0], pickle_file=None)
        surface1.wcc_calc(verbose=False,
                          num_strings=20,
                          gap_tol=None,
                          move_tol=None)
        
        self.assertFullAlmostEqual(surface0.get_res(), surface1.get_res())
        
    def test_change_uc_error(self):
        """test chaning the unit cell"""
        self.create_model(0.1, 0.3)
        self.assertRaises(ValueError, self.model.change_uc, [[2, 1, 1], [0, 1, 1], [0, 0, 1]])

    def test_supercell1(self):
        """test creating a supercell"""
        self.create_model(0.2, 0.3)
        model = self.model.supercell([1, 1, 2], [True, True, False])
        # call to Z2Pack
        tb_system = z2pack.em.tb.System(model)
        tb_surface = tb_system.surface(lambda kx, ky: [kx / 2, ky, 0], pickle_file=None)
        tb_surface.wcc_calc(verbose=False,
                            num_strings=5,
                            gap_tol=None,
                            move_tol=None)

        
        res = {'t_par': [0.0, 0.25, 0.5, 0.75, 1.0], 'wcc': [[0.00018584652615088768, 0.00052654182330485588, 0.4998372914935108, 0.49992766447046344, 0.50007233704101006, 0.50016271052371575, 0.99947345666522169, 0.99981415145662278], [0.0012567391209596947, 0.0015966595399664783, 0.49942846806072133, 0.49997284753055693, 0.50002747987360074, 0.50057175100131113, 0.99840312139800147, 0.99874293347488285], [0.002812743295723241, 0.003396096575638957, 0.49812251588687229, 0.49882860235070076, 0.50117418070079101, 0.50187950742987142, 0.99660188010761752, 0.99718447365278529], [0.0021036914741924717, 0.0045383598779368305, 0.49719681272509214, 0.49802383207652762, 0.50200860788467949, 0.50271981245510589, 0.9955450149418652, 0.9978638685646003], [0.00023787836608370744, 0.00028987264113971835, 0.49876361924521445, 0.49876916183511788, 0.50123037585975183, 0.50123596090847267, 0.99971054720517338, 0.9997625839390466]], 'lambda_': [array([[  9.99994427e-01 -3.04990367e-03j,
         -1.17251260e-03 -5.18187277e-04j,
          3.60658180e-04 -2.52847819e-04j,
          7.11393403e-05 +2.75976820e-05j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [  1.17250681e-03 -5.18180999e-04j,
          9.99994427e-01 +3.04991316e-03j,
          7.41540311e-05 -4.50224262e-05j,
         -3.53262046e-04 -2.60196516e-04j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [  3.61645373e-04 +2.51595207e-04j,
          7.37558733e-05 +4.48049788e-05j,
         -9.99999796e-01 +4.23587771e-04j,
         -7.29167753e-05 +1.47754373e-04j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [  7.07978115e-05 -2.73681578e-05j,
         -3.54259881e-04 +2.58948973e-04j,
          7.29209713e-05 +1.47761632e-04j,
         -9.99999798e-01 -4.23578272e-04j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          9.99999188e-01 -1.07724582e-03j,
          2.43508948e-04 -3.79197959e-04j,
          4.52469525e-04 +9.87950027e-05j,
         -1.27537383e-04 +1.73758432e-04j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
         -2.43509433e-04 -3.79188458e-04j,
          9.99999191e-01 +1.07725850e-03j,
         -1.16439784e-04 -1.91381355e-04j,
         -4.43210885e-04 +8.95889243e-05j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          4.52548238e-04 -9.88413949e-05j,
         -1.16815960e-04 +1.90938457e-04j,
         -9.99999345e-01 -1.01663472e-03j,
         -1.06730523e-04 +1.47169736e-05j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
         -1.27876525e-04 -1.73297243e-04j,
         -4.43287091e-04 -8.96283056e-05j,
          1.06724448e-04 +1.47210118e-05j,
         -9.99999352e-01 +1.01664740e-03j]]), array([[  9.94441492e-01 +5.97601318e-03j,
          4.00034619e-02 -9.70737084e-02j,
         -2.77091449e-03 +4.31473256e-03j,
         -4.22695357e-04 +5.91981110e-04j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [  3.94093950e-02 +9.73109762e-02j,
         -9.94472544e-01 -6.15304497e-05j,
         -1.32359193e-03 +2.16972031e-04j,
          1.61440136e-04 -5.61319607e-05j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [  2.75488033e-03 +4.33123046e-03j,
         -8.05301161e-04 -3.19016041e-04j,
          9.94441248e-01 -5.97401225e-03j,
         -9.69302418e-02 -4.03527531e-02j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [ -8.62540505e-04 -8.86801668e-04j,
         -1.44791087e-04 -4.02674943e-05j,
         -9.66786455e-02 +4.09397278e-02j,
         -9.94472534e-01 +6.36437431e-05j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          9.94491211e-01 +5.09439162e-03j,
          3.94362767e-02 -9.65816492e-02j,
         -7.80485529e-03 +3.66700378e-03j,
         -5.57501084e-04 -1.83552558e-03j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          3.91656581e-02 +9.66786343e-02j,
         -9.94534979e-01 +2.21162818e-03j,
          4.81603537e-04 -2.53328053e-03j,
          2.80728226e-04 -2.80170729e-03j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          7.78563395e-03 +3.63614925e-03j,
          1.24495461e-03 +1.63195539e-03j,
          9.94491742e-01 -5.09288423e-03j,
         -9.61723978e-02 -4.04110982e-02j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
         -1.73309356e-03 +1.93109511e-03j,
         -3.11329173e-04 -2.78207360e-03j,
         -9.60467203e-02 +4.06725117e-02j,
         -9.94535730e-01 -2.21038283e-03j]]), array([[  9.70090880e-01 -1.47567141e-02j,
         -5.52489840e-04 -2.42119437e-01j,
         -8.66476291e-03 +2.92252670e-03j,
          8.07803160e-05 +4.13276022e-04j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [  4.58938460e-03 +2.42072040e-01j,
         -9.70219967e-01 +5.83906379e-03j,
         -1.72943232e-04 -1.58029471e-03j,
          3.82080244e-03 +1.43534497e-03j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [  8.63368241e-03 +2.91584648e-03j,
         -3.84296531e-04 -2.04781292e-04j,
          9.70088552e-01 +1.47742144e-02j,
         -2.42128715e-01 -6.13639479e-04j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [ -1.70459401e-03 -2.00388930e-04j,
         -3.82811562e-03 +1.46631197e-03j,
         -2.42081129e-01 -4.52810475e-03j,
         -9.70217801e-01 -5.82159450e-03j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          9.70098560e-01 -1.85023813e-02j,
         -1.27483709e-03 -2.41802720e-01j,
         -8.99295265e-03 +3.81350207e-03j,
         -3.13927262e-04 +8.66708536e-04j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          5.85435151e-03 +2.41730600e-01j,
         -9.70256751e-01 +1.01056836e-02j,
         -6.44287149e-04 -1.69054788e-03j,
          4.75418649e-03 +2.42480050e-03j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          8.93501051e-03 +3.81270554e-03j,
         -8.60043597e-04 +8.15776913e-05j,
          9.70094923e-01 +1.85150683e-02j,
         -2.41818304e-01 -1.35028889e-03j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
         -1.92305181e-03 -6.48566908e-04j,
         -4.75612357e-03 +2.48269796e-03j,
         -2.41745622e-01 -5.77908855e-03j,
         -9.70253001e-01 -1.00929487e-02j]]), array([[ 0.91492878-0.00898086j, -0.16559773-0.36485885j,
         0.00598699-0.00701894j, -0.03220478+0.03402691j,
         0.00000000+0.j        ,  0.00000000+0.j        ,
         0.00000000+0.j        ,  0.00000000+0.j        ],
       [-0.15986722+0.36799327j, -0.91484097+0.00723319j,
        -0.00485511-0.04388954j, -0.00687880+0.0063185j ,
         0.00000000+0.j        ,  0.00000000+0.j        ,
         0.00000000+0.j        ,  0.00000000+0.j        ],
       [-0.00543744-0.00621484j, -0.00267709+0.04868739j,
         0.91493920+0.00919084j, -0.37550583+0.13910913j,
         0.00000000+0.j        ,  0.00000000+0.j        ,
         0.00000000+0.j        ,  0.00000000+0.j        ],
       [-0.02725761-0.03220145j,  0.00764377+0.00574771j,
        -0.37368480-0.14534956j, -0.91504771-0.00703555j,
         0.00000000+0.j        ,  0.00000000+0.j        ,
         0.00000000+0.j        ,  0.00000000+0.j        ],
       [ 0.00000000+0.j        ,  0.00000000+0.j        ,
         0.00000000+0.j        ,  0.00000000+0.j        ,
         0.91844408-0.02652259j, -0.15576200-0.3596176j ,
         0.00210019+0.00161117j, -0.03647600+0.02886003j],
       [ 0.00000000+0.j        ,  0.00000000+0.j        ,
         0.00000000+0.j        ,  0.00000000+0.j        ,
        -0.13930854+0.36637236j, -0.91871471+0.01424672j,
         0.00612742-0.04532155j,  0.00543515-0.00189944j],
       [ 0.00000000+0.j        ,  0.00000000+0.j        ,
         0.00000000+0.j        ,  0.00000000+0.j        ,
        -0.00228518+0.00202807j,  0.00426245+0.04612386j,
         0.91860805+0.02600264j, -0.36428502+0.14361279j],
       [ 0.00000000+0.j        ,  0.00000000+0.j        ,
         0.00000000+0.j        ,  0.00000000+0.j        ,
        -0.03721849-0.02696099j, -0.00502960-0.00167994j,
        -0.35746086-0.16001955j, -0.91883457-0.0147742j ]]), array([[  8.68408853e-01 -9.50996464e-04j,
         -3.51083826e-01 -3.45053816e-01j,
          3.88022075e-04 +1.98654749e-04j,
         -4.51229481e-02 +3.88188100e-02j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [ -3.48124392e-01 +3.48095596e-01j,
         -8.68502891e-01 +6.06349892e-03j,
          4.46930842e-02 -3.59536319e-02j,
          3.80365697e-03 -4.71684080e-04j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [ -1.44270427e-03 +1.84754513e-04j,
          4.38362432e-02 +3.75170229e-02j,
          8.68388662e-01 +9.49535614e-04j,
         -3.51274567e-01 +3.45217540e-01j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [ -4.59710166e-02 -3.72635647e-02j,
         -3.81156549e-03 +5.49347651e-04j,
         -3.48320449e-01 -3.48256758e-01j,
         -8.68237609e-01 -6.06731393e-03j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          8.65998989e-01 +1.70117277e-04j,
         -3.52634954e-01 -3.49305275e-01j,
          6.34185402e-04 +7.37294778e-05j,
         -4.53937296e-02 +4.02385242e-02j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
         -3.50177926e-01 +3.51809836e-01j,
         -8.66150501e-01 +5.77733823e-03j,
          4.45326802e-02 -3.67675720e-02j,
          4.28747865e-03 -1.33982336e-03j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
         -2.16720816e-03 +1.43527446e-04j,
          4.34357571e-02 +3.84691190e-02j,
          8.65996948e-01 -1.70638606e-04j,
         -3.52862270e-01 +3.49522847e-01j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
         -4.64767469e-02 -3.85509639e-02j,
         -4.21734331e-03 +1.49671083e-04j,
         -3.50417576e-01 -3.52024656e-01j,
         -8.65787879e-01 -5.78262631e-03j]])], 'kpt': [[0.0, 0.0, 0], [0.125, 0.0, 0], [0.25, 0.0, 0], [0.375, 0.0, 0], [0.5, 0.0, 0]], 'gap': [0.25018191665840783, 0.25051256380034392, 0.25075930623125564, 0.7491324136984856, 0.75047325405682308]}

        self.assertFullAlmostEqual(tb_surface.get_res(), res)

    def test_supercell_inplace(self):
        """test creating a supercell"""
        self.create_model(0.2, 0.3)
        model = self.model.supercell([1, 1, 2], [True, True, False])
        self.model.supercell([1, 1, 2], [True, True, False], in_place=True)
        system0 = z2pack.em.tb.System(model)
        surface0 = system0.surface(lambda kx, ky: [kx / 2, ky, 0], pickle_file=None)
        surface0.wcc_calc(verbose=False,
                          num_strings=20,
                          gap_tol=None,
                          move_tol=None)
        system1 = z2pack.em.tb.System(self.model)
        surface1 = system1.surface(lambda kx, ky: [kx / 2, ky, 0], pickle_file=None)
        surface1.wcc_calc(verbose=False,
                          num_strings=20,
                          gap_tol=None,
                          move_tol=None)
        
        self.assertFullAlmostEqual(surface0.get_res(), surface1.get_res())
        
    def test_supercell2(self):
        """test creating a supercell"""
        self.create_model(0.2, 0.3)
        model = self.model.supercell([1, 1, 3], [True, True, True])
        # call to Z2Pack
        tb_system = z2pack.em.tb.System(model)
        tb_surface = tb_system.surface(lambda kx, ky: [kx / 2, ky, 0], pickle_file=None)
        tb_surface.wcc_calc(verbose=False,
                            num_strings=5,
                            gap_tol=None,
                            move_tol=None,
                            pos_tol=None)

        
        res = {'t_par': [0.0, 0.25, 0.5, 0.75, 1.0], 'wcc': [[0.00068011198085075756, 0.37757942568470693, 0.49358994382892879, 0.49944386780276528, 0.50017708114703985, 0.50032221632239526, 0.50203591519484347, 0.54566697432587696, 0.92198496965049659, 0.96774957105449722], [2.4246218325936975e-05, 0.0014303002196092865, 0.412750220853701, 0.49156556727595452, 0.49720438144627255, 0.49999985614224673, 0.50000014356498701, 0.50423181629952329, 0.5384180583571575, 0.99997575407444028], [1.4135798584282307e-16, 0.11961071227110293, 0.47406263622230255, 0.49999999999999989, 0.49999999999999989, 0.49999999999999989, 0.50273843200422719, 0.52625584966387917, 0.99999999999999989, 1.0], [0.1325330926295796, 0.25926331593092206, 0.28334223763904803, 0.43626527124288461, 0.49697512189808585, 0.51421999025202081, 0.52617995303847698, 0.65246104082573386, 0.70869759693324474, 0.99830532690508922], [0.00060014317818727302, 0.0017384206217897875, 0.074289572681103574, 0.49240184456309144, 0.49957913523999264, 0.50006616641175605, 0.50042086748059345, 0.72863606591702035, 0.93174390643463412, 0.99826157665762416]], 'lambda_': [array([[  9.97973504e-01 -7.01273244e-05j,
         -6.21852349e-02 -1.52177619e-04j,
         -7.76669419e-04 -3.92359823e-04j,
          9.51127519e-03 -9.52011082e-03j,
          1.99093008e-32 +1.75741107e-33j,
         -3.96546945e-17 +7.67073037e-18j,
          6.10579978e-33 +1.22853266e-32j,
          6.57297567e-18 -9.54775538e-18j,
         -1.44165008e-18 +5.79370536e-19j,
         -4.01493617e-18 -3.62191288e-18j],
       [ -4.73923797e-05 -7.82900037e-06j,
          4.31836680e-02 +5.42105881e-05j,
          1.22642224e-04 +1.62134939e-04j,
          1.43777024e-01 -1.43417092e-01j,
          4.56369184e-16 -6.11180240e-17j,
         -8.70733603e-01 +3.49591885e-01j,
          2.27001233e-16 +2.34791040e-16j,
          9.70056641e-02 -2.27152194e-01j,
         -2.75481025e-02 +1.85140107e-02j,
         -1.04920582e-01 -5.81818140e-02j],
       [  5.18627004e-05 -4.90003259e-04j,
          1.28838373e-02 -1.36979652e-02j,
         -9.99817832e-01 +1.18323649e-03j,
         -1.50810973e-05 +3.00545630e-03j,
         -4.32371273e-32 +1.59852185e-31j,
          5.42101086e-18 -3.36536354e-16j,
         -1.09296524e-31 +4.22741623e-32j,
          6.14742632e-17 +6.33174069e-17j,
         -2.31070588e-18 -1.16822784e-17j,
          3.38000027e-17 -2.66713734e-17j],
       [  1.31809224e-04 +1.83975367e-04j,
         -1.43689958e-01 -1.44051173e-01j,
          1.31573798e-04 -9.48762656e-04j,
         -9.56814966e-01 -1.19914871e-03j,
          7.76635433e-17 +5.93185785e-17j,
         -1.83144240e-01 -7.82120055e-02j,
         -1.16908026e-18 +6.93049483e-17j,
          4.86490244e-02 -1.95321555e-02j,
         -6.91291855e-03 -1.35582014e-03j,
         -7.01446969e-03 -2.44781123e-02j],
       [  5.68592435e-03 +6.71593942e-03j,
          8.69767422e-02 +1.03213222e-01j,
         -3.00084266e-04 +2.61113966e-03j,
         -2.85982926e-02 -2.44143066e-03j,
          9.55912045e-01 +2.27875359e-01j,
          1.43652383e-02 +2.19075974e-03j,
         -1.12942787e-02 +5.71133331e-03j,
         -1.84192568e-03 +2.44728721e-03j,
          6.23676687e-03 -2.19767050e-03j,
         -6.35352008e-02 -1.03526444e-01j],
       [ -1.37525256e-02 -5.93848537e-02j,
         -2.08848228e-01 -9.11361326e-01j,
          1.01202904e-02 -1.51350170e-02j,
          1.68442539e-01 +1.05634780e-01j,
          1.01591916e-01 +8.80295606e-02j,
          6.44215145e-02 +2.47261706e-04j,
          2.74348580e-04 +2.60408738e-02j,
          1.72408103e-01 -1.72026570e-01j,
          1.53245922e-04 +6.81700295e-06j,
         -4.68929793e-04 -2.77847136e-03j],
       [ -1.66183483e-03 +2.62594955e-04j,
         -2.54993613e-02 +3.96918594e-03j,
         -3.96917525e-04 -3.08201322e-04j,
          3.23742767e-03 -4.43109676e-03j,
         -6.52051020e-03 -1.13820927e-02j,
         -4.64846902e-04 +2.63558169e-04j,
         -9.99542376e-01 +4.32448640e-04j,
         -1.19782482e-04 -1.11474332e-03j,
         -1.52282602e-04 +3.17996391e-04j,
          6.29858257e-03 +1.50775570e-03j],
       [  8.40634701e-03 -1.34577830e-02j,
          1.29415792e-01 -2.06125955e-01j,
          4.64913064e-03 -9.20635666e-04j,
          1.15346762e-02 +5.04544027e-02j,
          3.76891786e-03 +3.50830571e-02j,
         -1.73994848e-01 -1.74386962e-01j,
         -4.59918533e-03 +3.87961417e-03j,
         -9.35864974e-01 -1.08897285e-03j,
          5.52068451e-06 +6.03471580e-06j,
          8.70746742e-05 -1.22433993e-04j],
       [  1.75937440e-05 +4.40218334e-05j,
          2.68308899e-04 +6.75850772e-04j,
         -5.98953563e-06 +1.28307760e-05j,
         -1.41970448e-04 -6.12808450e-05j,
          5.24726676e-03 +3.42147316e-03j,
          3.21886596e-02 +6.87956341e-03j,
          6.55819561e-05 +3.19890951e-04j,
         -7.24469861e-03 +4.69255375e-03j,
         -9.99399248e-01 +1.17538250e-03j,
          1.03103342e-03 +9.23460961e-04j],
       [ -9.06541551e-04 +1.56884674e-04j,
         -1.39105461e-02 +2.37439465e-03j,
         -2.19490770e-04 -1.65337849e-04j,
          1.73465638e-03 -2.44871753e-03j,
         -8.60697098e-02 +8.58517992e-02j,
          7.43182506e-02 -9.10839102e-02j,
         -6.33697624e-03 -4.20787129e-05j,
          3.36136001e-03 +3.13843225e-02j,
          7.09351637e-04 -2.02248159e-03j,
         -9.84962141e-01 -1.21558734e-03j]]), array([[  9.94330671e-01 +1.51378024e-04j,
          4.06820360e-02 -9.82284714e-02j,
          4.82458605e-06 +1.17081408e-05j,
          4.20687169e-07 +1.62243346e-03j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [  4.06670272e-02 +9.82346636e-02j,
         -9.94330683e-01 -4.63933470e-07j,
         -1.14789054e-03 +1.14865732e-03j,
         -3.07659743e-08 +7.04277015e-08j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [ -4.81661778e-06 +1.17241682e-05j,
         -1.14710341e-03 -1.14751951e-03j,
          9.94330671e-01 -1.51379863e-04j,
         -9.82245690e-02 -4.06914612e-02j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [  6.68647308e-07 -1.62379458e-03j,
          4.67958120e-08 +6.24573290e-08j,
         -9.82183347e-02 +4.07064525e-02j,
         -9.94330683e-01 +4.62093853e-07j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          4.27791561e-02 -1.51523604e-01j,
         -1.64418259e-01 -1.20058352e-01j,
          8.99064072e-01 -3.16898724e-01j,
         -1.07744989e-01 +1.12786380e-01j,
         -2.35261170e-03 +3.47716246e-03j,
          2.45045152e-02 -8.62067337e-03j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          9.85330862e-02 -8.24504035e-02j,
         -9.68138222e-01 -3.05621189e-02j,
         -1.39010502e-01 +1.56141193e-01j,
          6.70478865e-03 -3.69822414e-02j,
          6.11957600e-04 -9.45608976e-04j,
         -4.04657693e-03 +1.15423250e-02j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          7.53239438e-01 +5.60194081e-01j,
         -6.58138612e-04 +1.37707327e-01j,
          4.94449016e-02 -1.50228974e-01j,
          7.94205984e-02 -9.48744699e-02j,
         -1.50026200e-01 -1.03622391e-01j,
         -1.09393787e-01 +1.19642797e-01j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
         -8.84686994e-03 +1.34260474e-01j,
         -1.45216636e-02 +6.82372696e-03j,
         -1.24708744e-01 -7.89887256e-02j,
         -9.79160106e-01 +1.16459183e-02j,
          4.55831690e-03 -2.28732275e-02j,
         -2.02297083e-02 -1.89283135e-03j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
         -1.76718951e-01 -1.26599292e-02j,
         -1.43375904e-02 -2.19866641e-02j,
          5.15087250e-03 +2.26875811e-02j,
         -6.25329629e-03 -3.57452522e-05j,
         -9.82235715e-01 -3.71671538e-02j,
          2.34537219e-03 -3.41598983e-02j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
         -1.84939631e-02 -1.66374919e-01j,
          1.81721453e-02 -9.30469384e-03j,
          6.04240227e-03 +1.31225263e-02j,
         -4.38412268e-03 +5.89711141e-04j,
          2.78128302e-03 -3.94342495e-03j,
         -9.85286478e-01 +2.27935659e-02j]]), array([[  9.70142500e-01 +3.21791205e-16j,
         -9.15933995e-16 -2.42535625e-01j,
         -1.02116400e-15 +9.23811689e-17j,
         -6.29631304e-16 +4.31859371e-16j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [ -7.77156117e-16 +2.42535625e-01j,
         -9.70142500e-01 -3.33066907e-16j,
         -1.83546722e-15 +1.67310583e-16j,
          6.41352571e-17 -3.34322486e-16j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [  6.82882574e-16 +5.16288952e-17j,
         -1.63205177e-15 -7.12311321e-16j,
          9.70142500e-01 -3.67761377e-16j,
         -2.42535625e-01 +7.70217223e-16j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [ -5.85937798e-16 -3.08255121e-16j,
         -5.17611422e-16 +9.21148387e-17j,
         -2.42535625e-01 -1.08246745e-15j,
         -9.70142500e-01 -3.33066907e-16j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          9.70142500e-01 +6.43381261e-17j,
          3.76763110e-16 -2.42535625e-01j,
          1.53075794e-16 +5.59714289e-16j,
         -3.49797502e-16 +3.54025891e-17j,
         -2.69376594e-17 -7.48520898e-17j,
         -1.37232572e-18 -3.66717455e-18j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          2.42113843e-16 +2.42535625e-01j,
         -9.70142500e-01 -2.63035097e-16j,
          4.11454724e-17 +1.37896286e-15j,
         -4.35361382e-15 +4.01377065e-15j,
         -3.53382146e-17 -2.14282395e-16j,
         -2.17682173e-18 -9.77449551e-18j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          2.72544286e-16 -4.75570672e-16j,
          2.91413215e-16 -8.03258285e-17j,
          6.99368130e-01 -6.71039223e-01j,
         -2.08925144e-01 -1.70220744e-02j,
         -9.29371884e-02 +8.93178157e-02j,
         -4.08298834e-03 +4.41006623e-03j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          7.54814776e-16 -9.16675996e-16j,
          2.83833287e-15 +3.43101198e-15j,
         -1.36696546e-01 +1.55488033e-01j,
         -9.77739374e-01 +6.17995536e-03j,
          1.86727882e-02 -2.78197233e-02j,
          7.93499949e-04 -1.34566322e-03j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          1.73943472e-19 +1.77521473e-19j,
         -5.52939852e-18 -4.33906400e-18j,
         -1.31023308e-01 -2.28608664e-02j,
          6.04999270e-04 -6.89837086e-03j,
         -9.77606978e-01 -1.62931827e-01j,
          3.67750258e-04 +3.06754151e-05j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          1.00231546e-20 +5.79234114e-21j,
         -3.02327152e-19 -1.25613858e-19j,
         -6.16485817e-03 +6.11261851e-04j,
         -5.90441282e-05 -3.17100000e-04j,
          4.57852827e-04 -5.76691364e-05j,
         -9.86406028e-01 +1.64208560e-01j]]), array([[  8.94543908e-01 -1.17493377e-02j,
         -1.57319571e-01 -3.82864016e-01j,
         -9.58901484e-02 -8.85938565e-02j,
         -4.59740591e-02 -2.36459269e-02j,
         -9.54047312e-03 +8.39717886e-03j,
         -3.93182456e-04 +3.43701803e-04j,
          4.55960813e-04 -1.22431159e-03j,
          4.70386663e-05 -2.19284855e-05j,
          6.67903899e-03 +1.21285859e-02j,
          2.94860510e-02 -8.58932854e-02j],
       [ -1.43032435e-01 +3.80595209e-01j,
         -9.08018037e-01 -6.52341989e-03j,
          6.25808885e-02 +2.71725631e-03j,
          1.17045629e-02 +3.26708232e-02j,
          2.26599040e-03 -9.44244407e-03j,
          9.44256461e-05 -3.87666235e-04j,
          2.53731931e-04 +9.65391870e-04j,
         -1.97384725e-05 +3.43905617e-05j,
         -9.50763049e-03 -4.63856252e-03j,
          1.93642182e-02 +6.66275711e-02j],
       [ -7.18016840e-02 -1.32917902e-01j,
         -2.79067186e-02 -1.47795170e-02j,
          5.18384459e-01 -5.43487355e-01j,
         -3.75502283e-01 -1.51031361e-01j,
         -6.82149378e-02 -2.94063863e-03j,
         -2.80248703e-03 -1.30349428e-04j,
          6.32149329e-03 -3.04940990e-03j,
          2.63893014e-04 +8.99777479e-05j,
         -1.92274321e-02 +7.18554708e-02j,
          4.33793314e-01 -2.23244406e-01j],
       [  5.88515201e-02 +5.65154314e-02j,
          3.67899604e-02 +4.18397630e-02j,
          9.14814016e-02 +1.95776747e-01j,
         -8.31642998e-01 +2.66118360e-01j,
          5.57217434e-02 -1.71933888e-02j,
          2.29196178e-03 -6.98685427e-04j,
         -4.21125959e-03 +4.26578297e-03j,
         -2.38099747e-04 +3.27880556e-06j,
         -5.13458578e-03 -6.33204104e-02j,
         -2.84974205e-01 +3.03979618e-01j],
       [ -8.40395569e-03 -2.43793187e-03j,
         -5.46159373e-04 -3.11491140e-04j,
         -7.60525133e-02 -3.89782909e-03j,
         -2.56838774e-02 -2.09894866e-02j,
         -1.66638254e-01 -8.55689945e-01j,
         -4.47822830e-01 +9.37331151e-02j,
          1.19125494e-01 -3.07842339e-02j,
          5.18701351e-04 +5.87520330e-02j,
          4.83222371e-02 -3.69384706e-02j,
          6.54221600e-03 -3.72283467e-02j],
       [  5.16944683e-05 +1.46550101e-04j,
          1.14963559e-06 +1.11065967e-05j,
          7.30086972e-04 +1.13840407e-03j,
         -3.74956567e-05 +5.87869238e-04j,
          7.33598721e-03 +4.61834791e-01j,
         -8.72122456e-01 -1.13778196e-02j,
          1.30363120e-02 -1.09202740e-01j,
          6.88515893e-02 +7.05844589e-02j,
         -1.13149735e-02 -9.02435172e-03j,
          2.80992473e-02 +5.57552742e-02j],
       [ -4.85403574e-04 +7.03661632e-03j,
         -1.52115391e-04 +4.83434487e-04j,
          9.91656028e-03 +6.05767637e-02j,
         -1.21487742e-02 +2.38170108e-02j,
         -5.78156601e-02 -6.00283484e-02j,
         -7.31076291e-02 -8.26190270e-02j,
         -3.01154774e-01 -1.08284225e-01j,
          1.75688052e-01 -6.93524450e-01j,
          2.01279246e-01 +5.66532605e-01j,
         -2.38901127e-02 +6.72275770e-03j],
       [ -2.89962992e-03 -5.16719507e-05j,
         -2.01704466e-04 -5.23192196e-05j,
         -2.46665483e-02 +5.34311726e-03j,
         -1.00348932e-02 -4.48889726e-03j,
          4.90560136e-02 -6.08113985e-02j,
          2.31916769e-02 -3.51381460e-02j,
         -4.11188194e-01 -6.74794826e-01j,
         -5.14791934e-01 +1.91099446e-01j,
         -2.24588472e-01 +1.22204840e-01j,
          1.51092082e-03 -5.18058200e-03j],
       [ -1.87169254e-03 -8.87719284e-03j,
          1.83640027e-05 -6.51615514e-04j,
         -3.35536087e-02 -7.14695525e-02j,
          6.66404387e-03 -3.37380507e-02j,
         -3.28046894e-02 -5.35221950e-02j,
         -9.41109795e-02 -6.13382520e-02j,
         -4.15020575e-01 +2.70468115e-01j,
         -3.83287954e-02 -4.14104766e-01j,
         -5.69602042e-01 -4.82108918e-01j,
         -1.37823474e-02 -2.29880195e-02j],
       [  3.74318700e-02 -5.69544247e-02j,
          3.57179340e-03 -3.35012309e-03j,
          2.03548152e-01 -5.57102014e-01j,
          2.15164954e-01 -1.42991262e-01j,
         -1.45224504e-02 -3.40689684e-02j,
         -2.50580337e-03 +5.79571466e-02j,
          1.76112145e-03 -2.08980606e-02j,
          1.74512454e-02 +1.40177128e-02j,
         -2.54032623e-03 +4.99018865e-02j,
         -5.77320604e-01 +4.85098541e-01j]]), array([[  8.70284275e-01 -8.35646756e-03j,
         -3.48951004e-01 -3.42234387e-01j,
          5.56947884e-03 +3.35177575e-05j,
         -4.64586980e-02 +3.81423760e-02j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [ -3.45344521e-01 +3.46475302e-01j,
         -8.70342753e-01 +1.59638496e-03j,
          4.40908098e-02 -3.53316424e-02j,
         -1.78551278e-04 +7.83954148e-04j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [ -5.58884967e-03 +3.65811465e-05j,
          4.64306318e-02 +3.81219536e-02j,
          8.70285656e-01 +8.35649720e-03j,
         -3.48951932e-01 +3.42235696e-01j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [ -4.41190288e-02 -3.53518380e-02j,
          1.81747044e-04 +8.03076760e-04j,
         -3.45345588e-01 -3.46476733e-01j,
         -8.70339492e-01 -1.59638042e-03j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          7.51467084e-01 +3.81869625e-01j,
          8.31996595e-02 -2.14079550e-02j,
         -4.70138643e-01 -1.94318232e-01j,
          6.34192477e-02 -2.94868720e-04j,
          6.44004814e-03 +5.64768957e-03j,
         -1.20505274e-01 +6.84501904e-02j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          1.15445703e-01 -5.62155603e-02j,
         -4.70369611e-01 -5.57494303e-03j,
         -5.97654751e-02 +9.25416516e-03j,
          1.10658215e-01 +1.90396467e-01j,
         -3.95041596e-02 +1.44909575e-02j,
          1.46100162e-02 -8.41484298e-01j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
         -5.10985771e-01 -3.12903471e-02j,
         -1.08629966e-02 -4.65214721e-03j,
         -8.55945462e-01 +7.96207876e-04j,
         -7.66055472e-03 -6.11445123e-02j,
         -8.41118341e-04 -3.27198091e-03j,
          3.29508618e-02 -1.53958536e-02j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
         -9.78746821e-03 -9.89093517e-02j,
          5.98845938e-01 +1.17561243e-01j,
         -4.74987751e-02 +3.23053875e-02j,
         -1.84281193e-01 +7.24233064e-01j,
         -1.13248018e-01 -7.40734543e-02j,
         -6.14275336e-02 -1.83918054e-01j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
         -1.11468204e-02 -6.82536699e-03j,
          3.74191067e-02 -3.34792698e-02j,
         -3.40980505e-03 +7.88377392e-03j,
          3.39535893e-02 +1.26855052e-01j,
          9.89296954e-01 +2.02001003e-03j,
         -8.02222360e-03 -3.48192597e-02j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          2.91395712e-02 +7.48764433e-04j,
          3.86108132e-01 +4.97155483e-01j,
          9.76674969e-03 +3.79515455e-02j,
          5.43308341e-01 -2.69782187e-01j,
          1.47808339e-02 +3.00273664e-02j,
          4.39595937e-01 -1.97586602e-01j]])], 'kpt': [[0.0, 0.0, 0], [0.125, 0.0, 0], [0.25, 0.0, 0], [0.375, 0.0, 0], [0.5, 0.0, 0]], 'gap': [0.18912976883277882, 0.76919690621579884, 0.76312792483193959, 0.85350146191916698, 0.28334570862209751]}

        self.assertFullAlmostEqual(tb_surface.get_res(), res)
        
    def test_supercell3(self):
        """test creating a supercell"""
        self.create_model(0.2, 0.3)
        model = self.model.supercell([2, 1, 3], [True, True, True])
        # call to Z2Pack
        tb_system = z2pack.em.tb.System(model)
        tb_surface = tb_system.surface(lambda kx, ky: [kx / 2, ky, 0], pickle_file=None)
        tb_surface.wcc_calc(verbose=False,
                            num_strings=5,
                            gap_tol=None,
                            move_tol=None)

        
        res = {'t_par': [0.0, 0.25, 0.5, 0.75, 1.0], 'wcc': [[0.024898821638441416, 0.041571788691557483, 0.08579029533750207, 0.47112804345977649, 0.48146024819527866, 0.49130851360709932, 0.50977958526186451, 0.5151125757401267, 0.53121103373585388, 0.91601098903239031, 0.94648908191945946, 0.98523902338064995], [0.16735469289255278, 0.18842203292762208, 0.22891175598839175, 0.46508567619874436, 0.49050771649208186, 0.50001766473099829, 0.5008266935454202, 0.51775537271617211, 0.52580687631658296, 0.74236243741675068, 0.81407160211535945, 0.85887747865932318], [0.27696391770836987, 0.35500967881430745, 0.42811297350873556, 0.46876004456644299, 0.48282327237595407, 0.49077278940602753, 0.50415176708193399, 0.52075171970289791, 0.53274040686674295, 0.61263001413419305, 0.62538038755004766, 0.70190302828434659], [0.37582474981984948, 0.4368773422425356, 0.46769072246918897, 0.47388571845380573, 0.47909562180105919, 0.48925678692151536, 0.50753742085223319, 0.52265411716188481, 0.53376533079411848, 0.54225402773323861, 0.56799153308711103, 0.60316662866345938], [0.27836323648981393, 0.34241487602859927, 0.37170942799182977, 0.41379270723775874, 0.44660767385275946, 0.47868629137715235, 0.51217236870701877, 0.5286513427132784, 0.55310254199448994, 0.61591247370541824, 0.70631634227944651, 0.75227071762243369]], 'lambda_': [array([[  9.76322430e-01 +3.47860190e-02j,
          8.63936985e-03 -9.01342694e-02j,
         -9.30777345e-02 -4.35655515e-02j,
         -5.86845164e-02 +1.45187059e-02j,
         -4.63033633e-02 +8.83613121e-02j,
         -6.89177205e-02 -9.20225943e-02j,
         -1.81249195e-15 +8.18890464e-16j,
         -7.02491423e-16 +1.20303496e-16j,
          1.27712189e-15 +2.37586073e-16j,
         -1.02421126e-15 -5.25913272e-16j,
         -5.74243546e-16 +2.34156234e-16j,
         -1.87976975e-15 +7.82721181e-16j],
       [  2.14249838e-02 -7.90757863e-02j,
          9.27728777e-01 -1.11976968e-01j,
          8.08293879e-02 -1.38860352e-02j,
          1.10276390e-01 +2.42893351e-01j,
          4.13911298e-02 -1.89137594e-01j,
          4.91894537e-02 +4.77318881e-02j,
          4.56276026e-16 -2.02865940e-15j,
          7.50660996e-17 +1.58332357e-15j,
         -1.39262972e-16 +1.77784557e-16j,
         -4.27038993e-16 -5.58583103e-16j,
         -7.41904569e-16 +1.19927425e-15j,
          8.25351838e-16 +4.54081837e-15j],
       [  1.06521153e-01 -2.72904308e-02j,
         -1.07460194e-01 +8.02673506e-03j,
          9.63074835e-01 -4.74386022e-02j,
          1.07359301e-01 -5.74409573e-02j,
          1.24155672e-01 -1.04019495e-01j,
         -5.73907049e-02 -4.66790433e-02j,
         -6.23100873e-16 +4.12223305e-16j,
          1.30166812e-15 +9.39577561e-16j,
          9.55581748e-16 -1.09363434e-15j,
          2.00886764e-15 -3.91810029e-16j,
          1.05506080e-15 +1.72818140e-15j,
          2.04122666e-15 -3.02929605e-16j],
       [  1.05362462e-01 +1.71359859e-02j,
         -1.13583415e-01 +2.50899217e-01j,
         -9.68460338e-02 -1.34673811e-02j,
          8.91244121e-01 +4.83414008e-02j,
         -6.95904468e-02 -6.14480203e-02j,
          2.19027156e-01 +2.23491425e-01j,
         -3.64853799e-16 +6.84343554e-16j,
         -7.41244736e-16 +1.14585886e-15j,
          1.42636285e-15 -5.12776721e-16j,
          3.00218848e-16 +7.66440631e-16j,
          1.24381176e-16 +1.45253085e-16j,
         -2.06338115e-15 -7.00376833e-16j],
       [  9.52032113e-03 +9.04258893e-02j,
          6.64222334e-03 -1.56106100e-01j,
         -1.17230931e-01 -1.31247854e-01j,
          9.63656712e-02 -1.16863838e-01j,
          9.32265103e-01 +1.80248931e-01j,
         -1.81305123e-02 +1.07098477e-01j,
          3.85293563e-17 +2.66563891e-16j,
          1.24935183e-15 -6.02421615e-16j,
         -1.18025635e-15 +5.53889919e-16j,
         -1.31327837e-15 -1.02616145e-15j,
          2.26458855e-15 +5.10076060e-16j,
          8.01100948e-16 +9.79723921e-16j],
       [  3.63373760e-02 -7.61455093e-02j,
         -7.68644066e-02 -2.82231787e-02j,
          7.18985845e-02 -8.51456722e-02j,
         -1.99116515e-01 +2.26092744e-01j,
          5.69722611e-02 +1.13379488e-01j,
          9.25105212e-01 -1.05222924e-01j,
         -3.30440848e-16 +2.37090725e-15j,
         -4.75197341e-16 +1.93526107e-15j,
          9.11486824e-16 -6.24897842e-16j,
          1.13131560e-15 +8.58571440e-16j,
         -4.86968528e-16 +2.25132188e-15j,
          1.65717705e-15 +3.17893163e-17j],
       [ -6.04818119e-16 -8.33661308e-16j,
          6.77496758e-16 +7.09384979e-16j,
          6.28037990e-16 +5.02914168e-16j,
          7.22494108e-16 -6.10139787e-17j,
          7.15208094e-16 -3.45448470e-16j,
         -5.16213887e-17 -2.25034778e-15j,
         -9.92558394e-01 -4.04583542e-03j,
         -1.18172070e-02 -5.55357696e-02j,
         -7.69124138e-03 -2.99830750e-02j,
         -9.47243068e-02 +2.45486417e-02j,
         -1.12544132e-02 +2.63399651e-02j,
         -5.44179073e-03 +1.42849296e-02j],
       [ -1.96952038e-16 -4.87366634e-16j,
          7.04355688e-16 -1.07001600e-15j,
          1.21623158e-15 -3.81349162e-16j,
          2.02995032e-16 -1.66700389e-15j,
          1.26833279e-15 +6.09003110e-16j,
         -1.05276222e-15 -2.56978661e-15j,
          1.21718287e-02 -5.91596448e-02j,
         -9.96137158e-01 +3.17922026e-02j,
         -2.67959396e-02 -4.47970030e-03j,
         -5.92630603e-03 +1.88690746e-02j,
         -4.63927666e-03 +2.40911237e-02j,
          3.63211643e-02 -1.27113766e-03j],
       [  4.00687243e-16 +5.40294470e-16j,
         -6.39460430e-16 +5.93244182e-16j,
          6.10468337e-16 +1.48508015e-15j,
          9.42341870e-16 +9.95427365e-16j,
         -6.41138014e-16 -3.61302627e-16j,
          9.75869732e-16 +1.36200335e-15j,
          4.37101072e-03 -3.30158301e-02j,
          2.88237511e-02 -4.00156457e-03j,
         -9.92742765e-01 -6.43514797e-02j,
          5.94419075e-02 +4.74685677e-02j,
         -1.98794534e-02 -4.34089293e-02j,
          1.02228175e-02 +1.39312354e-02j],
       [ -3.32745117e-16 +2.32469772e-16j,
          4.29100292e-16 +1.20296538e-15j,
          1.98381597e-15 +1.07845572e-16j,
          3.03818837e-16 +6.13312459e-16j,
         -4.91452563e-16 +1.07460442e-16j,
          1.11865682e-15 -1.39782290e-15j,
          9.15490124e-02 +1.86039188e-02j,
          7.54937439e-03 +2.27792046e-02j,
         -5.72060494e-02 +5.16072133e-02j,
         -9.88946645e-01 +5.23384236e-02j,
         -4.16742199e-03 -6.28530549e-02j,
          3.67302879e-03 +4.98079486e-03j],
       [ -1.39407847e-15 -1.86530866e-16j,
         -6.58647006e-16 -1.90921018e-15j,
          8.81640188e-17 -2.30854290e-15j,
          7.96332430e-16 -7.93670988e-16j,
          2.25742811e-15 -8.19295723e-16j,
         -8.60186740e-16 -1.75793848e-15j,
          8.93202189e-03 +3.42543754e-02j,
         -3.19949508e-03 +2.64416019e-02j,
          1.87608165e-02 -4.19024744e-02j,
          1.60677942e-03 -5.74009367e-02j,
         -9.88097242e-01 -3.39538140e-02j,
         -1.23055002e-01 -8.20476714e-04j],
       [ -1.85514672e-15 -1.15468274e-15j,
         -9.01406800e-17 -4.64106442e-15j,
          1.58865535e-15 -2.92151701e-16j,
         -7.25823506e-16 +7.75190356e-16j,
          8.58026940e-16 -2.22642880e-16j,
          1.30145175e-15 -3.46829469e-16j,
          4.91740166e-03 +7.04604338e-03j,
         -3.65649498e-02 -2.65574512e-03j,
         -1.44028754e-02 +1.93234392e-02j,
         -1.38774655e-03 +1.38834075e-02j,
          1.21812800e-01 +1.69088093e-03j,
         -9.91281456e-01 +1.80684554e-02j]]), array([[ -9.99461028e-01 +6.18333510e-03j,
         -1.65600655e-03 -5.61547917e-03j,
          5.40180273e-16 +3.26124415e-16j,
         -2.09914322e-15 -8.36337906e-16j,
          1.82789862e-02 -1.71892958e-02j,
         -3.53724270e-03 -2.22156541e-03j,
         -7.65237067e-03 -4.59792047e-03j,
          1.30772655e-02 -1.03628232e-02j,
          1.32978233e-16 -1.74375482e-16j,
         -1.19911250e-16 -3.32597745e-16j,
         -6.94159128e-20 -8.95393495e-16j,
          2.90085432e-16 +4.17586384e-16j],
       [  1.27723339e-03 -6.21606661e-03j,
         -9.97117152e-01 +2.60340568e-02j,
          2.16169146e-16 -4.65228165e-16j,
          7.72242747e-16 +5.27685063e-16j,
         -1.05098997e-02 -4.13947557e-04j,
         -2.87424521e-02 -7.62159832e-03j,
          2.79313847e-02 +5.33695314e-02j,
          1.36240683e-02 -1.51793321e-02j,
          9.00080650e-17 +1.43454933e-15j,
         -1.64093604e-17 -5.43938997e-16j,
         -2.53238990e-15 -1.84092046e-16j,
         -1.51254973e-15 +9.77175549e-16j],
       [ -1.11237688e-15 +1.78497984e-16j,
          4.81260774e-16 +1.27499700e-15j,
          3.87061147e-01 +8.79173103e-01j,
          1.64810275e-01 +1.90924611e-01j,
         -2.99939668e-16 -4.95000410e-17j,
         -1.25298165e-15 +4.84717579e-16j,
         -5.58272727e-17 +8.32313623e-16j,
          4.07719657e-16 -1.21387446e-15j,
          3.30617714e-03 +1.28439291e-03j,
         -3.05154162e-02 +4.09752346e-02j,
          3.38317336e-02 +2.28937848e-02j,
          8.75292978e-02 -4.08761523e-02j],
       [  5.54252438e-16 +1.10180086e-15j,
         -9.76781556e-17 -4.12215905e-16j,
         -1.32528001e-01 +2.23412959e-01j,
          2.30419193e-01 -9.17627087e-01j,
          2.58213546e-16 -8.18527592e-16j,
         -1.60738854e-15 -1.06680283e-16j,
          5.60432502e-16 +1.25132199e-15j,
         -1.45126771e-15 -8.45350881e-16j,
          2.94421918e-02 +1.58833462e-02j,
          9.25505332e-03 -9.27984046e-02j,
         -1.05200728e-01 -7.19410674e-02j,
         -3.27544207e-02 -1.01284841e-01j],
       [ -1.89703544e-02 -1.55796227e-02j,
          1.77423630e-02 -7.89880165e-04j,
          4.60149221e-17 -1.53400897e-15j,
          9.20156675e-16 -2.60311057e-17j,
         -9.89061971e-01 +1.25172098e-02j,
         -1.07053271e-02 -6.60650161e-02j,
          8.72764591e-02 +7.23994172e-02j,
          4.72144164e-02 +3.33837439e-02j,
         -2.24548337e-16 +1.58274566e-15j,
          1.05054004e-16 -1.46822748e-15j,
         -1.07083544e-15 -2.82527648e-15j,
         -1.63214556e-15 +2.52212562e-16j],
       [  5.00024912e-03 -4.13679437e-03j,
          3.35475042e-02 -9.90793521e-03j,
         -6.46790679e-16 -1.65121354e-15j,
         -1.10112236e-15 +1.46337708e-15j,
          1.66044727e-02 -6.87160326e-02j,
         -9.91515857e-01 -5.35441610e-03j,
          5.21313228e-02 +5.29591284e-02j,
         -5.71286175e-03 -7.10586783e-02j,
          3.68383820e-16 -4.55544290e-16j,
          1.23428810e-16 -1.02193824e-15j,
         -2.20088271e-17 +1.17104289e-16j,
         -2.11582225e-16 -3.91155889e-16j],
       [  3.58506628e-03 -6.25304577e-03j,
         -2.48856676e-02 +4.96261465e-02j,
          5.32097452e-17 -6.09468513e-16j,
         -8.26438562e-16 -1.17903216e-15j,
         -9.28113821e-02 +7.19217804e-02j,
         -5.87616483e-02 +4.31602540e-02j,
         -9.85914478e-01 -1.08846600e-03j,
         -7.49700782e-02 -1.07007720e-02j,
         -1.30309019e-17 -7.52948433e-16j,
         -1.07958961e-15 +1.29384393e-15j,
          8.00121077e-16 +7.92592799e-16j,
          2.26460927e-16 -9.57234926e-16j],
       [ -1.41091925e-02 -1.01691347e-02j,
         -1.07138347e-02 -1.75921374e-02j,
          3.27840617e-16 +2.04225044e-16j,
          4.16535638e-16 +1.52371362e-15j,
         -3.63481842e-02 +2.74595387e-02j,
          9.97721312e-03 -7.79198135e-02j,
          7.66471457e-02 -2.70250419e-03j,
         -9.91838194e-01 -3.74419590e-02j,
         -8.04126326e-16 -3.46490920e-16j,
         -1.04411522e-16 +3.32910667e-16j,
          1.78401211e-15 +1.12257105e-15j,
         -2.37047453e-16 +1.03669968e-15j],
       [ -7.90831329e-17 +1.70914249e-16j,
         -8.72337199e-17 -1.98972195e-15j,
         -6.88573709e-03 -4.75728953e-02j,
          5.35240291e-02 -9.23961439e-02j,
         -1.02386514e-15 -4.54478485e-16j,
         -2.19512348e-16 -5.64253473e-16j,
          1.12156440e-15 +1.20489537e-15j,
          7.61836336e-16 -5.91805537e-16j,
          1.23141472e-01 +4.60060169e-01j,
         -5.46258908e-01 -1.48510509e-02j,
          5.08370177e-01 +4.24747649e-01j,
          1.35123173e-01 +6.11550021e-02j],
       [ -9.48009483e-16 +8.34130916e-18j,
         -5.37710113e-17 -1.40220070e-15j,
          8.23175449e-03 +3.25095504e-02j,
          6.67235463e-02 -1.15997213e-02j,
         -5.42721100e-16 -1.52308837e-15j,
         -5.18939260e-16 -1.55791491e-16j,
         -1.02461404e-15 +3.38940994e-16j,
          7.33076114e-16 +1.14495260e-15j,
          6.29503237e-01 -8.78125504e-03j,
          4.65662062e-01 -7.68480353e-03j,
          2.44132332e-02 +4.40902849e-01j,
         -3.01844677e-01 +3.08116209e-01j],
       [  3.08716737e-17 +7.82685299e-17j,
          1.08730781e-16 +3.62638037e-16j,
         -1.33832360e-02 +4.29703544e-02j,
          1.55433527e-02 -1.32128898e-01j,
         -8.78884228e-16 +1.10778070e-15j,
         -1.33476772e-15 -2.26267265e-16j,
          4.66675562e-16 -1.01872146e-15j,
          2.31752876e-15 -3.64056551e-16j,
         -5.98844033e-01 -4.65603276e-03j,
          2.86353834e-01 +4.66194463e-01j,
          3.47587338e-01 +1.29968103e-01j,
         -1.99959738e-01 +3.80276983e-01j],
       [ -1.01880887e-15 -2.09437274e-16j,
         -1.08062861e-15 -1.17288197e-15j,
         -5.60702010e-02 -3.40095145e-02j,
         -8.19517308e-02 -2.91326238e-02j,
         -2.80022887e-15 +9.31104286e-16j,
          3.31668624e-17 +5.35482516e-16j,
          1.13231908e-15 -1.51366818e-16j,
          4.64309058e-16 -1.33803289e-16j,
         -7.90205601e-02 -1.04007578e-01j,
          3.98656690e-01 +1.22107033e-01j,
          1.43146734e-01 +4.35943569e-01j,
          4.27610571e-01 -6.35489573e-01j]]), array([[ -6.94813496e-01 +6.84282824e-01j,
         -2.88040659e-15 +1.28206576e-15j,
         -9.30796925e-16 +1.65088775e-15j,
          7.74810514e-16 +9.49486057e-16j,
         -8.83861532e-16 +5.33682013e-16j,
          5.86990653e-17 +2.44780103e-16j,
          6.34534344e-16 -3.63529612e-16j,
         -5.14978390e-02 +1.50059806e-02j,
          4.78297798e-02 +1.27557892e-01j,
         -5.89498253e-02 -7.61479701e-03j,
          4.47705934e-02 +1.96274304e-02j,
         -1.19639120e-01 +8.55516388e-02j],
       [  1.88678805e-15 -1.23866192e-15j,
         -9.97936192e-01 -5.97079622e-02j,
         -5.46295286e-03 -7.16823590e-03j,
          1.52019543e-02 -5.70238099e-04j,
          8.79459314e-03 +9.70155542e-03j,
         -7.59637940e-03 +3.21003367e-04j,
          3.13627141e-03 +2.56032230e-03j,
         -2.92990724e-17 -3.73757976e-16j,
          8.37707732e-16 -2.24074753e-15j,
         -9.52441806e-16 +1.02651500e-15j,
         -1.60071157e-16 +2.26231774e-16j,
          1.93824132e-15 -3.04500633e-16j],
       [  1.88225025e-15 +9.04419094e-18j,
          3.95503628e-03 -7.81687742e-03j,
         -9.88515885e-01 +1.08896212e-01j,
         -8.59418422e-02 -1.29599979e-02j,
          2.85828008e-02 -1.54761442e-02j,
         -2.21234339e-02 -3.21813826e-02j,
         -2.70963503e-02 -5.60938844e-03j,
          1.49301042e-15 -5.10591638e-16j,
          2.56809191e-15 -2.41828501e-15j,
         -2.28066925e-15 +1.20842557e-15j,
         -2.67434174e-16 +2.77214275e-15j,
         -1.56567048e-15 +1.15335616e-15j],
       [  1.35692127e-16 +8.33974702e-16j,
         -1.46803815e-02 -3.48900901e-03j,
          8.73711498e-02 -1.56079507e-02j,
         -9.85749459e-01 -1.13709853e-01j,
          5.03953237e-02 -3.62170518e-02j,
         -4.26854728e-02 +3.76236642e-02j,
         -8.47443123e-03 +1.01139535e-02j,
          1.44834859e-15 -1.46604662e-15j,
          1.52088990e-15 -1.01200504e-15j,
         -6.06625585e-16 -4.31122844e-16j,
          8.39380988e-16 +1.44638616e-16j,
         -3.01716637e-16 -2.49409469e-16j],
       [  1.38024456e-17 +3.22101763e-16j,
         -9.85794439e-03 +7.97609006e-03j,
         -2.63137741e-02 -4.00673391e-03j,
         -5.17813572e-02 -4.24714730e-02j,
         -9.87633524e-01 +4.81455040e-02j,
          4.10635018e-02 +2.34990482e-02j,
          1.86981783e-02 -1.19664506e-01j,
         -1.01031659e-15 +6.45335094e-16j,
          1.18000763e-15 -3.96002572e-16j,
          1.82730231e-15 +3.08913654e-15j,
         -3.75351739e-16 +1.85366185e-15j,
          1.64250255e-15 -1.31108025e-15j],
       [  3.95377043e-16 +7.46171767e-16j,
          7.68933740e-03 +2.52934850e-03j,
          1.49769122e-02 -3.71399853e-02j,
          3.75395548e-02 +3.95467541e-02j,
         -4.52506277e-02 +1.76059350e-02j,
         -9.94080091e-01 -8.07629173e-03j,
         -6.86105517e-02 -5.67233664e-03j,
          9.96218567e-16 -1.10528175e-16j,
         -8.03921098e-16 -3.33991147e-16j,
         -1.22742085e-17 -1.05203572e-15j,
         -1.24132299e-15 -4.79031869e-16j,
         -5.54073278e-16 +1.30865940e-16j],
       [ -6.29082154e-16 -7.21339830e-16j,
         -4.94724973e-03 +1.75727617e-03j,
          2.44136528e-02 -1.05463496e-02j,
          1.11068181e-02 +1.01354875e-03j,
         -2.57952974e-02 -1.18994669e-01j,
          6.84133534e-02 -5.06476447e-04j,
         -9.89470896e-01 +2.41323272e-02j,
         -8.07624801e-16 +1.23873140e-15j,
          1.52149944e-16 -5.58687985e-16j,
         -9.33571591e-16 -6.21348852e-16j,
          3.67572878e-16 +2.03298465e-15j,
         -8.44053984e-16 +1.35388168e-15j],
       [  4.77839036e-02 -1.38734607e-02j,
          1.61373289e-16 -1.15696854e-15j,
         -3.93644518e-16 -2.69724003e-15j,
         -2.61297544e-18 -2.22748610e-15j,
          6.75621130e-16 +8.76207141e-16j,
          1.79129762e-17 -1.08960496e-15j,
         -2.16174639e-18 +6.69853312e-16j,
         -7.28028701e-01 -4.81925467e-01j,
         -1.01924953e-01 -5.13873581e-02j,
          2.53701988e-01 +2.11763468e-01j,
          1.79270675e-01 +1.69743001e-01j,
         -9.45252662e-02 +2.07660231e-01j],
       [ -7.62106122e-02 +1.10769462e-01j,
          4.76323081e-16 -1.04943314e-15j,
         -1.62233972e-15 -6.54112405e-16j,
         -1.74890759e-16 -1.45964973e-15j,
         -5.00077601e-16 +1.71522443e-15j,
          8.86339916e-16 -1.25051069e-16j,
         -1.17696280e-15 -8.85494042e-17j,
         -1.29633636e-01 -1.82367126e-01j,
         -5.24449795e-01 -4.14460650e-01j,
         -2.37062162e-01 -8.21705551e-02j,
         -1.99681487e-01 -4.98399365e-01j,
          3.52066047e-01 -9.92905268e-02j],
       [  8.77992106e-02 +1.37587910e-03j,
         -3.86305453e-16 +2.51377368e-16j,
          1.31334150e-15 +8.94801976e-16j,
         -2.54067002e-16 -2.36995067e-17j,
         -2.27842804e-15 +9.72123863e-16j,
          9.92141959e-16 -1.14530800e-15j,
          4.30997669e-16 -3.40619413e-16j,
         -1.56379380e-01 -1.87856388e-01j,
         -1.87108426e-02 +1.66169019e-01j,
         -4.96418325e-01 -7.04396200e-01j,
          6.53196676e-02 +3.77746961e-01j,
          1.15843382e-01 +3.99794932e-02j],
       [ -1.10783527e-01 -4.44258791e-02j,
          1.84317669e-15 +3.59839988e-16j,
          2.15618300e-15 +3.06122740e-16j,
          3.00617219e-16 -3.48029601e-16j,
          2.50083031e-15 +1.56502116e-15j,
         -3.74474851e-17 -8.73350204e-16j,
          6.95059160e-16 +2.34269554e-16j,
         -1.84335256e-01 +1.40033700e-01j,
          4.01209633e-01 -3.42871525e-01j,
         -1.08337065e-01 +1.45030055e-01j,
         -6.22922811e-01 +3.11344680e-01j,
          2.98164841e-01 +2.16778984e-01j],
       [  4.62687848e-02 -6.58746745e-02j,
         -3.92156238e-16 +1.69173393e-16j,
          1.44125545e-15 -1.35665606e-15j,
         -5.88219717e-16 -1.57516646e-15j,
         -1.66268646e-15 +1.26075082e-15j,
          6.67189496e-16 -3.20240949e-16j,
          1.97216565e-15 -5.52848369e-16j,
          1.47743339e-01 +2.22756926e-01j,
         -4.49666772e-01 -1.13552740e-01j,
         -2.05486721e-01 +8.18987803e-02j,
         -4.41718718e-02 +1.20441504e-01j,
         -3.77560503e-01 +7.06424170e-01j]]), array([[ -9.33430641e-01 +3.06038621e-01j,
         -1.77142151e-15 -1.89527828e-16j,
         -4.22519315e-02 +5.74235901e-02j,
         -3.80241377e-16 +6.04384828e-17j,
          4.12314223e-16 +7.20304079e-16j,
         -4.88141515e-02 -1.15527493e-01j,
          1.71637433e-15 -9.90578828e-16j,
          4.14074934e-02 -8.88046750e-02j,
          5.39222132e-02 +1.93549362e-02j,
          4.74471386e-16 +6.04363864e-16j,
          4.81787008e-16 -7.58243854e-17j,
          1.74645152e-02 -3.23636311e-02j],
       [  1.54742570e-15 -1.20961718e-15j,
         -9.94674999e-01 -8.10710663e-02j,
          1.85290521e-15 -1.54969710e-15j,
         -4.34637291e-02 +8.48791157e-03j,
          1.41682571e-02 +2.61892239e-02j,
          1.35311158e-15 -7.37299924e-16j,
         -4.93995181e-03 -2.64933193e-02j,
          1.32246473e-15 -1.19369042e-15j,
          6.39862095e-16 -2.78845184e-15j,
          1.51673152e-02 -7.15005952e-03j,
         -1.15738970e-02 +7.74268832e-03j,
          8.29448659e-16 -1.30577970e-15j],
       [  2.20813820e-02 +4.82590782e-02j,
         -2.12849618e-15 -2.43226046e-16j,
         -8.68621353e-01 -4.29670587e-01j,
          2.51001573e-16 +7.49054611e-17j,
         -4.47217840e-16 -8.84518234e-16j,
         -1.36433957e-01 +9.85460718e-03j,
         -5.45643798e-16 -2.26860675e-16j,
         -1.91978786e-02 +4.81338753e-02j,
         -8.88047518e-03 +2.74433887e-02j,
          6.60736224e-16 -9.64295620e-16j,
         -1.29999102e-15 -1.32613126e-15j,
         -1.32490228e-01 +1.35207899e-01j],
       [ -2.06827868e-16 +1.00733173e-16j,
          4.34906323e-02 +6.21687211e-03j,
          3.37086110e-17 -5.30089484e-17j,
         -9.90454939e-01 +1.00838187e-01j,
         -5.00031443e-03 -6.14671466e-02j,
          8.56141632e-16 -5.37343636e-16j,
         -2.38861782e-02 -4.19908282e-02j,
         -2.01851062e-16 -6.83741998e-16j,
         -3.86519525e-16 -2.63800559e-15j,
          1.42560015e-02 -2.28883450e-02j,
          2.49211179e-03 -5.50234954e-03j,
          1.13591322e-15 -1.45619784e-15j],
       [  1.26156538e-16 +2.31881769e-16j,
         -1.79592269e-02 +2.72348398e-02j,
          1.95297024e-16 -2.71539694e-16j,
         -4.36198656e-04 -6.24743591e-02j,
         -9.87709939e-01 -1.68609346e-02j,
          1.39648599e-15 -1.80956085e-16j,
         -1.90110894e-02 -3.55667305e-02j,
          7.03577009e-16 -1.68076219e-15j,
          1.93392138e-15 +1.73713610e-15j,
         -1.04708457e-01 +1.03524578e-02j,
         -3.97042794e-02 -7.00242918e-02j,
         -1.51475796e-15 +2.78744642e-16j],
       [  4.88475033e-02 -1.42769300e-01j,
          6.05961114e-16 -1.46345436e-15j,
          3.38599855e-02 +1.01122742e-01j,
          2.80621979e-16 +1.24453990e-16j,
         -2.63895309e-15 -1.09848796e-15j,
         -8.54052029e-01 -2.93721743e-01j,
          7.23802393e-16 -4.02535541e-15j,
         -2.62425456e-01 -1.95001518e-01j,
         -8.79150809e-02 +4.41110221e-02j,
          1.33600157e-15 -2.00827570e-15j,
          7.41719508e-17 +1.53300255e-15j,
          7.55760352e-02 -1.67038670e-01j],
       [ -9.42393131e-16 -5.51768908e-16j,
          6.88833895e-03 -2.35491044e-02j,
          3.82267715e-16 +2.36549904e-16j,
          2.50713094e-02 -4.20832578e-02j,
          2.34465754e-02 -3.04182513e-02j,
          6.14322202e-16 -4.64603829e-15j,
         -9.90336592e-01 -4.39223501e-02j,
         -1.45838104e-15 -1.69001984e-15j,
          3.08183314e-15 +1.93636040e-15j,
          6.43595169e-02 -1.57484543e-02j,
         -3.23800178e-02 -8.59595416e-02j,
         -3.10973467e-16 +2.24425924e-15j],
       [ -6.86488126e-02 -8.16587215e-03j,
         -5.69457118e-16 -1.05532423e-15j,
         -3.73607127e-02 +3.08796078e-02j,
          3.74189335e-16 +1.08906910e-16j,
         -1.61096606e-15 -1.63542079e-15j,
          2.32106564e-01 -1.80822526e-01j,
          1.14181881e-15 -2.26757510e-15j,
         -8.33255964e-01 +3.77225436e-01j,
         -6.26142574e-02 -2.26281097e-01j,
          1.01070279e-15 -1.67180498e-17j,
         -1.42544719e-15 -3.77159736e-16j,
          1.18140971e-01 +2.46077894e-02j],
       [ -5.54350914e-02 +3.62693826e-02j,
          1.05826400e-15 -1.12721365e-15j,
          5.03611213e-02 -2.19451422e-02j,
         -2.29747083e-16 -1.47427436e-15j,
         -8.87794637e-16 +1.67080364e-15j,
          3.00760149e-02 +1.25874591e-01j,
         -1.00536415e-15 +1.74490081e-15j,
         -2.11165155e-02 -1.61231494e-01j,
         -9.09425139e-01 +7.43045926e-02j,
         -1.51541252e-15 -8.12457430e-16j,
          3.18469696e-16 +6.16525045e-16j,
          8.26509873e-02 +3.31657546e-01j],
       [ -6.71334838e-17 +3.25930872e-16j,
         -1.22511677e-02 -1.18165185e-02j,
         -2.22374728e-16 +5.20268923e-17j,
         -1.70327036e-02 -1.64234528e-02j,
          1.00230828e-01 +4.27368181e-03j,
         -1.05547401e-15 -2.44740985e-15j,
         -6.99199916e-02 -7.95060630e-03j,
         -9.61641938e-16 -2.16424763e-16j,
          7.66158156e-16 -1.19251418e-15j,
         -9.84616202e-01 +7.22990652e-02j,
          7.46171996e-02 +6.22092407e-02j,
         -4.62081930e-16 -4.90463018e-16j],
       [ -5.07428852e-16 -2.25064586e-16j,
          9.78376594e-03 +8.20498685e-03j,
          9.80875829e-16 -6.66290842e-16j,
          2.45286451e-03 +9.30977125e-04j,
          5.32954668e-02 -7.12394234e-02j,
         -4.34652964e-16 +1.02913818e-15j,
          3.63805527e-02 -7.96379815e-02j,
          6.46953283e-16 -7.20772024e-16j,
         -5.42240291e-16 +1.00634059e-15j,
         -6.92355849e-02 +6.35668010e-02j,
         -9.87126759e-01 -3.15486124e-02j,
          8.97851146e-16 -2.10577104e-15j],
       [  4.68055698e-03 -1.64971873e-02j,
         -8.34144504e-16 -1.02251960e-15j,
          3.57973959e-02 +1.94361702e-01j,
         -1.70681528e-16 -3.10404526e-16j,
          4.33124527e-16 +1.24675527e-15j,
          8.43759169e-02 -1.98603602e-01j,
          1.98982957e-15 +2.31292249e-15j,
         -1.33180534e-01 -5.28410233e-03j,
         -8.32395575e-02 +3.02627122e-01j,
         -1.90616040e-16 -3.85721655e-16j,
         -8.34849030e-16 -2.26526038e-15j,
         -8.93175476e-01 -6.77628134e-03j]]), array([[-0.92143046-0.06374662j,  0.11573238+0.02308363j,
         0.14456902+0.15465513j,  0.00927601-0.08029813j,
        -0.08514394-0.11357846j, -0.08527196+0.02212557j,
        -0.05161732-0.00883175j, -0.01686474+0.02262237j,
         0.00498289-0.0920892j , -0.08148840+0.02151737j,
         0.07583731+0.10432528j,  0.08768746-0.10120029j],
       [-0.16696318+0.01310962j, -0.90412554+0.1973896j ,
         0.02167589-0.18876717j,  0.07529667+0.05521622j,
         0.05057445+0.12646489j,  0.11336326-0.05274025j,
        -0.03672168-0.0729041j ,  0.07360988-0.0059855j ,
        -0.00723893-0.13205663j, -0.03667913-0.039341j  ,
        -0.04743941-0.00637801j, -0.03973668+0.01297079j],
       [-0.17024397+0.06363851j, -0.06482157-0.04287175j,
        -0.75439876+0.03788652j, -0.11242435+0.01913442j,
        -0.24239517+0.02931262j,  0.00369111+0.24546346j,
         0.14289853-0.03692519j, -0.04156821+0.07890355j,
         0.01305302+0.04909249j,  0.40048286+0.1089989j ,
        -0.14338205-0.11872752j,  0.10954824+0.0790452j ],
       [ 0.05220044-0.03974946j, -0.06340337+0.08149359j,
         0.03988501-0.12561926j, -0.74062597+0.19908048j,
        -0.09014445-0.14416881j, -0.17345487+0.07991925j,
         0.03903804-0.26587876j, -0.02269079-0.21607351j,
        -0.04619188+0.09447919j, -0.00517935-0.19374778j,
         0.07862285+0.30359982j,  0.05380863-0.21172093j],
       [ 0.14436428-0.09662585j, -0.09359597+0.13132756j,
         0.13836121+0.15293074j,  0.06123598-0.22454927j,
        -0.61796812-0.34936298j,  0.26061406+0.04967032j,
         0.00935069-0.07387418j,  0.13834906-0.04349029j,
        -0.10601934-0.02521392j,  0.11636877+0.02514515j,
         0.44913456-0.10331129j, -0.06347223+0.06111608j],
       [ 0.04810395-0.03468896j, -0.10873002+0.10711596j,
         0.17644180+0.03538308j,  0.02530288-0.16040785j,
         0.00910632+0.31021619j, -0.42696771+0.2882808j ,
        -0.15717401+0.17271735j, -0.06275740+0.20971597j,
         0.26604506+0.25863567j,  0.30113156-0.0076782j ,
         0.34951066+0.23891162j,  0.05532188+0.19885936j],
       [-0.01944851+0.05876738j, -0.03726765-0.10330785j,
        -0.18190606+0.01592958j, -0.16656046-0.15932854j,
         0.09112682-0.15200569j,  0.24798684-0.08638076j,
        -0.70442478+0.11353201j,  0.21225015-0.18819436j,
         0.31157569+0.2712759j , -0.10361658+0.10089631j,
        -0.02376595-0.02042256j,  0.12017150+0.02618532j],
       [ 0.01926068-0.0376269j ,  0.02188030+0.00454957j,
         0.11413749-0.05345135j, -0.00784106-0.22614879j,
         0.15414934+0.0615315j ,  0.35791908+0.17139581j,
        -0.17068204-0.16354849j, -0.70476359-0.20499133j,
        -0.02951995-0.19124487j,  0.27544367+0.14403083j,
         0.00155244+0.09262547j, -0.01481675-0.09021481j],
       [-0.05275802-0.07344496j, -0.07111585-0.14540096j,
        -0.21132102+0.2333359j , -0.16444466-0.13041942j,
         0.26753027+0.13497161j, -0.12134673+0.09211748j,
        -0.10322225+0.2317403j ,  0.03248079-0.27356119j,
        -0.53453765-0.06609871j, -0.09326838-0.08575289j,
         0.30818572-0.12393663j, -0.36207194+0.14708356j],
       [ 0.15507817+0.04036147j, -0.10231487+0.02253923j,
        -0.12630814+0.21046797j, -0.16328482-0.24529512j,
        -0.16976773+0.04623947j, -0.21450641+0.18697582j,
        -0.09777257-0.08544237j, -0.27664034+0.30156983j,
         0.06700748-0.24198627j, -0.62703099+0.10933293j,
        -0.04086163-0.14498025j,  0.16847794-0.0274648j ],
       [ 0.03838282-0.03367479j, -0.00885824+0.05799503j,
         0.19576222-0.04432851j,  0.09709585+0.03258478j,
        -0.15585682-0.25939105j, -0.28517122+0.3596393j ,
        -0.37004493+0.11127179j,  0.01378012-0.01032189j,
        -0.15512356-0.11473107j,  0.19668607-0.30618216j,
        -0.49056347-0.223693j  , -0.15836692-0.07677117j],
       [-0.05461003-0.05250785j, -0.02081364+0.10026034j,
        -0.03978890+0.0760774j , -0.08166007-0.22509114j,
         0.03440633-0.00721797j,  0.03695510+0.03766509j,
         0.20001195-0.0315193j , -0.02737611+0.07778713j,
         0.37449836+0.26847012j, -0.05513456+0.0328743j ,
        -0.08613728-0.12542334j, -0.71235057-0.3467153j ]])], 'kpt': [[0.0, 0.0, 0], [0.125, 0.0, 0], [0.25, 0.0, 0], [0.375, 0.0, 0], [0.5, 0.0, 0]], 'gap': [0.27845916939863924, 0.013116085775938036, 0.9894334729963582, 0.98949568924165443, 0.015316977056123893]}

        self.assertFullAlmostEqual(tb_surface.get_res(), res)
        
    def test_supercell4(self):
        """test creating a supercell"""
        self.create_model(0.2, 0.3)
        model = self.model.supercell([1, 1, 1], [False, False, False])
        # call to Z2Pack
        tb_system = z2pack.em.tb.System(model)
        tb_surface = tb_system.surface(lambda kx, ky: [kx / 2, ky, 0], pickle_file=None)
        tb_surface.wcc_calc(verbose=False,
                            num_strings=5,
                            gap_tol=None,
                            move_tol=None)

        
        res = {'t_par': [0.0, 0.25, 0.5, 0.75, 1.0], 'wcc': [[8.7596557220151364e-19, 8.7596557220151364e-19, 0.5, 0.5], [8.7596557220151364e-19, 8.7596557220151364e-19, 0.5, 0.5], [8.7596557220151364e-19, 8.7596557220151364e-19, 0.5, 0.5], [8.7596557220151364e-19, 8.7596557220151364e-19, 0.5, 0.5], [8.7596557220151364e-19, 8.7596557220151364e-19, 0.5, 0.5]], 'lambda_': [array([[ 0.98058068 -1.21430643e-17j, -0.19611614 -1.59594560e-16j,
         0.00000000 +0.00000000e+00j,  0.00000000 +0.00000000e+00j],
       [-0.19611614 +1.04083409e-16j, -0.98058068 +1.11022302e-16j,
         0.00000000 +0.00000000e+00j,  0.00000000 +0.00000000e+00j],
       [ 0.00000000 +0.00000000e+00j,  0.00000000 +0.00000000e+00j,
         0.98058068 -1.21430643e-17j, -0.19611614 -1.59594560e-16j],
       [ 0.00000000 +0.00000000e+00j,  0.00000000 +0.00000000e+00j,
        -0.19611614 +1.04083409e-16j, -0.98058068 +1.11022302e-16j]]), array([[ 0.98058068 -1.21430643e-17j, -0.19611614 -1.59594560e-16j,
         0.00000000 +0.00000000e+00j,  0.00000000 +0.00000000e+00j],
       [-0.19611614 +1.04083409e-16j, -0.98058068 +1.11022302e-16j,
         0.00000000 +0.00000000e+00j,  0.00000000 +0.00000000e+00j],
       [ 0.00000000 +0.00000000e+00j,  0.00000000 +0.00000000e+00j,
         0.98058068 -1.21430643e-17j, -0.19611614 -1.59594560e-16j],
       [ 0.00000000 +0.00000000e+00j,  0.00000000 +0.00000000e+00j,
        -0.19611614 +1.04083409e-16j, -0.98058068 +1.11022302e-16j]]), array([[ 0.98058068 -1.21430643e-17j, -0.19611614 -1.59594560e-16j,
         0.00000000 +0.00000000e+00j,  0.00000000 +0.00000000e+00j],
       [-0.19611614 +1.04083409e-16j, -0.98058068 +1.11022302e-16j,
         0.00000000 +0.00000000e+00j,  0.00000000 +0.00000000e+00j],
       [ 0.00000000 +0.00000000e+00j,  0.00000000 +0.00000000e+00j,
         0.98058068 -1.21430643e-17j, -0.19611614 -1.59594560e-16j],
       [ 0.00000000 +0.00000000e+00j,  0.00000000 +0.00000000e+00j,
        -0.19611614 +1.04083409e-16j, -0.98058068 +1.11022302e-16j]]), array([[ 0.98058068 -1.21430643e-17j, -0.19611614 -1.59594560e-16j,
         0.00000000 +0.00000000e+00j,  0.00000000 +0.00000000e+00j],
       [-0.19611614 +1.04083409e-16j, -0.98058068 +1.11022302e-16j,
         0.00000000 +0.00000000e+00j,  0.00000000 +0.00000000e+00j],
       [ 0.00000000 +0.00000000e+00j,  0.00000000 +0.00000000e+00j,
         0.98058068 -1.21430643e-17j, -0.19611614 -1.59594560e-16j],
       [ 0.00000000 +0.00000000e+00j,  0.00000000 +0.00000000e+00j,
        -0.19611614 +1.04083409e-16j, -0.98058068 +1.11022302e-16j]]), array([[ 0.98058068 -1.21430643e-17j, -0.19611614 -1.59594560e-16j,
         0.00000000 +0.00000000e+00j,  0.00000000 +0.00000000e+00j],
       [-0.19611614 +1.04083409e-16j, -0.98058068 +1.11022302e-16j,
         0.00000000 +0.00000000e+00j,  0.00000000 +0.00000000e+00j],
       [ 0.00000000 +0.00000000e+00j,  0.00000000 +0.00000000e+00j,
         0.98058068 -1.21430643e-17j, -0.19611614 -1.59594560e-16j],
       [ 0.00000000 +0.00000000e+00j,  0.00000000 +0.00000000e+00j,
        -0.19611614 +1.04083409e-16j, -0.98058068 +1.11022302e-16j]])], 'kpt': [[0.0, 0.0, 0], [0.125, 0.0, 0], [0.25, 0.0, 0], [0.375, 0.0, 0], [0.5, 0.0, 0]], 'gap': [0.25, 0.25, 0.25, 0.25, 0.25]}

        self.assertFullAlmostEqual(tb_surface.get_res(), res)

    def test_precompute(self):
        """ test that precomputation will be redone after changing _hop or _on_site"""
        self.create_model(0.1, 0.3)
        self.model._unchanged = True
        self.model._hop = []
        self.assertEqual(self.model._unchanged, False)
        self.model._unchanged = True
        self.model._on_site = []
        self.assertEqual(self.model._unchanged, False)

    def test_warning(self):
        """ test the warning that is given when string_vec != None"""
        self.create_model(0.1, 0.3)
        # call to Z2Pack
        tb_system = z2pack.em.tb.System(self.model)
        with warnings.catch_warnings(record=True) as w:
            warnings.simplefilter('always')
            tb_surface = tb_system.surface(lambda kx: [kx / 2, 0, 0], [0, 1, 0], pickle_file=None)
            assert len(w) == 1
            assert w[-1].category == DeprecationWarning
            assert "string_vec" in str(w[-1].message)

    def test_saveload(self):
        self.create_model(0.1, 0.3)
        tb_system = z2pack.em.tb.System(self.model)
        surface1 = tb_system.surface(lambda kx, ky: [kx / 2, ky, 0], pickle_file=self._build_folder + '/tb_pickle.txt')
        surface2 = tb_system.surface(lambda kx, ky: [kx / 2, ky, 0], pickle_file=self._build_folder + '/tb_pickle.txt')
        surface1.wcc_calc(verbose=False)
        surface2.load()
        self.assertFullAlmostEqual(surface1.get_res(), surface2.get_res())

    def testkwargcheck1(self):
        """ test kwarg check on wcc_calc """
        self.create_model(0.1, 0.3)
        # call to Z2Pack
        tb_system = z2pack.em.tb.System(self.model)
        tb_surface = tb_system.surface(lambda kx, ky: [kx / 2, ky, 0], pickle_file=None)
        self.assertRaises(
            TypeError,
            tb_surface.wcc_calc,
            invalid_kwarg = 3)

    def testkwargcheck2(self):
        """ test kwarg check on __init__ """
        self.create_model(0, 0.3)
        # call to Z2Pack
        tb_system = z2pack.em.tb.System(self.model)
        self.assertRaises(
            TypeError,
            tb_system.surface,
            1, 2, 0, invalid_kwarg = 3)

if __name__ == "__main__":
    unittest.main()
